(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[4005],{9543:(O,ee,z)=>{z(9993),Opal.queue(function(c){var I,j,X,f,p,h,x,Q,M,P=[],e=c.nil,A=c.module,N=c.klass,E=c.const_set,$=c.truthy,m=c.def,G=c.send,R=c.to_ary,k=c.rb_gt,g=c.rb_plus,T=c.neqeq,C=c.eqeq,U=c.rb_le,q=c.rb_lt,w=c.rb_minus,F=c.rb_divide;return I=P,j=M=[A(P[0],"BCDice")].concat(I),x=[A(M[0],"GameSystem")].concat(j),Q=c.$r(x),X=x,p=[f=N(x[0],Q("Base"),"TorgEternity")].concat(X),h=c.$r(p),f.$$prototype.randomizer=e,E(p[0],"ID","TorgEternity"),E(p[0],"NAME","\u30c8\u30fc\u30b0 \u30a8\u30bf\u30cb\u30c6\u30a3"),E(p[0],"SORT_KEY","\u3068\u304a\u304f\u3048\u305f\u306b\u3066\u3044"),E(p[0],"HELP_MESSAGE",'\u30fb\u5224\u5b9a\n\u3000\u30fbTG\n\u3000\u3000"TG[m]"\u30671d20\u3092\u30ed\u30fc\u30eb\u3057\u307e\u3059\u3002[]\u5185\u306f\u7701\u7565\u53ef\u80fd\u3002\n\u3000\u3000m\u306f\u6280\u80fd\u57fa\u672c\u5024\u3092\u5165\u308c\u3066\u4e0b\u3055\u3044\u3002R\u30b3\u30de\u30f3\u30c9\u306b\u8aad\u66ff\u3055\u308c\u307e\u3059\u3002\n\u3000\u3000\u632f\u308a\u8db3\u3057\u3092\u81ea\u52d5\u3067\u884c\u3044\u300120\u306e\u51fa\u76ee\u304c\u51fa\u305f\u3068\u304d\u306b\u306f\u6280\u80fd\u7121\u3057\u5024\u3082\u4e26\u8a18\u3057\u307e\u3059\u3002\n\u3000\u3000(TORG\u30c0\u30a4\u30b9\u30dc\u30c3\u30c8\u3068\u540c\u3058\u6319\u52d5\u3092\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3067\u3059\u3002\u30ed\u30fc\u30eb\u30dc\u30fc\u30ca\u30b9\u306e\u8aad\u307f\u66ff\u3048\u306e\u307f\u3001Eternity\u7248\u3068\u306a\u308a\u307e\u3059)\n\u3000\u30fbTE\n\u3000\u3000"TE"\u30671d20\u3092\u30ed\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u3000\u3000\u632f\u308a\u8db3\u3057\u3092\u81ea\u52d5\u3067\u884c\u3044\u300120\u306e\u51fa\u76ee\u304c\u51fa\u305f\u3068\u304d\u306b\u306f\u6280\u80fd\u7121\u3057\u5024\u3082\u4e26\u8a18\u3057\u307e\u3059\u3002\n\u3000\u3000\u51fa\u76ee1\u306e\u6642\u306b\u306f\u300cMishap!\u3000\u81ea\u52d5\u5931\u6557\uff01\u300d\u3068\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\u3000\u30fbUP\n\u3000\u3000"UP"\u3067\u9ad8\u63da\u72b6\u614b\u306e\u30ed\u30fc\u30eb(\u901a\u5e38\u306e1d20\u306b\u52a0\u3048\u30011d20\u3092\u8ffd\u52a0\u3067\u632f\u308a\u8db3\u3057)\u3092\u884c\u3044\u307e\u3059\u3002\n\u3000\u3000\u5404\u30ed\u30fc\u30eb\u3067\u306e\u632f\u308a\u8db3\u3057\u3092\u81ea\u52d5\u3067\u884c\u3044\u300120\u306e\u51fa\u76ee\u304c\u51fa\u305f\u3068\u304d\u306b\u306f\u6280\u80fd\u7121\u3057\u5024\u3082\u4e26\u8a18\u3057\u307e\u3059\u3002\n\u3000\u3000\u4e00\u6295\u76ee\u3067\u51fa\u76ee1\u306e\u6642\u306b\u306f\u300cMishap!\u3000\u81ea\u52d5\u5931\u6557\uff01\u300d\u3068\u51fa\u529b\u3055\u308c\u3001\u4e8c\u6295\u76ee\u306f\u884c\u308f\u308c\u307e\u305b\u3093\u3002\n\u3000\u30fbPOS\n\u3000\u3000"POSm"\u3067\u3001\u30dd\u30b7\u30d3\u30ea\u30c6\u30a3\u4f7f\u7528\u306b\u3088\u308b1d20\u306e\u30ed\u30fc\u30eb\u3092\u884c\u3044\u307e\u3059\u3002\n\u3000\u3000m\u306f\u30dd\u30b7\u30d3\u30ea\u30c6\u30a3\u3092\u4f7f\u7528\u3059\u308b\u524d\u306e\u30ed\u30fc\u30eb\u7d50\u679c\u3092\u5165\u308c\u3066\u4e0b\u3055\u3044\u3002\n\u3000\u3000\u51fa\u76ee\u304c10\u672a\u6e80\u306e\u5834\u5408\u306f\u300110\u3078\u306e\u8aad\u307f\u66ff\u3048\u304c\u884c\u308f\u308c\u307e\u3059\u3002\n\u3000\u3000\u307e\u305f\u3001\u632f\u308a\u8db3\u3057\u3092\u81ea\u52d5\u3067\u884c\u3044\u300120\u306e\u51fa\u76ee\u304c\u51fa\u305f\u3068\u304d\u306b\u306f\u6280\u80fd\u7121\u3057\u5024\u3082\u4e26\u8a18\u3057\u307e\u3059\u3002\n\u30fb\u30dc\u30fc\u30ca\u30b9\u30c0\u30e1\u30fc\u30b8\u30ed\u30fc\u30eb\n\u3000"xBD[+y]"\u3067\u30ed\u30fc\u30eb\u3057\u307e\u3059\u3002[]\u5185\u306f\u7701\u7565\u53ef\u80fd\u3002\n\u3000x\u306f\u30c0\u30e1\u30fc\u30b8\u30c0\u30a4\u30b9\u6570\u3002y\u306f\u30c0\u30e1\u30fc\u30b8\u57fa\u672c\u5024 or \u5f0f\u3092\u5165\u308c\u3066\u4e0b\u3055\u3044\u3002\n\u3000x\u306f1\u4ee5\u4e0a\u304c\u5fc5\u8981\u3067\u3059\u30020\u3060\u3068\u30a8\u30e9\u30fc\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\u30de\u30a4\u30ca\u30b9\u5024\u306f\u30b3\u30de\u30f3\u30c9\u3068\u3057\u3066\u8a8d\u8b58\u3055\u308c\u307e\u305b\u3093\u3002\n\u3000\u632f\u308a\u8db3\u3057\u51e6\u7406\u306f\u81ea\u52d5\u3067\u884c\u308f\u308c\u307e\u3059\u3002(\u632f\u308a\u8db3\u3057\u767a\u751f\u6642\u306e\u76ee\u306f\u3001\u300c5\u221e\u300d\u3068\u51fa\u529b\u3055\u308c\u307e\u3059)\n\u30fb\u5404\u7a2e\u8868\n\u3000"(\u8868\u30b3\u30de\u30f3\u30c9)(\u6570\u5024)"\u3067\u632f\u308a\u307e\u3059\u3002\n\u3000\u30fb\u6210\u529f\u30ec\u30d9\u30eb\u8868\u300cRTx or RESULTx\u300d\n\u3000\u30fb\u30c0\u30e1\u30fc\u30b8\u7d50\u679c\u8868\u300cDTx or DAMAGEx\u300d\n\u3000\u30fb\u30ed\u30fc\u30eb\u30dc\u30fc\u30ca\u30b9\u8868\u300cBTx+y or BONUSx+y or TOTALx+y\u300d x\u306f\u6570\u5024, y\u306f\u6280\u80fd\u57fa\u672c\u5024\n'),f.$register_prefix("TE","UP","POS","\\d+BD","TG","RT","Result","DT","damage","BT","bonus","total","1R20"),m(f,"$eval_game_system_specific_command",function(u){var l,r,i,n,_,a,d,t=this;return $(l=$(r=$(i=$(n=$(_=$(a=$(d=t.$torg_check(u))?d:t.$getRolld20DiceCommandResult(u))?a:t.$getUpRollDiceCommandResult(u))?_:t.$getPossibilityRollDiceCommandResult(u))?n:t.$getBonusDamageDiceCommandResult(u))?i:t.$getSuccessLevelDiceCommandResult(u))?r:t.$getDamageResultDiceCommandResult(u))?l:t.$getRollBonusDiceCommandResult(u)},1),m(f,"$replace_text",function(u){return(u=G(u,"gsub",[/TG(\d+)/i],function(){return"1R20+"+h("Regexp").$last_match(1)},0)).$gsub(/TG/i,"1R20")},1),m(f,"$torg_check",function(u){var t,l,r=this,i=e,n=e,_=e,a=e,d=e,s=e,o=e;return u=r.$replace_text(u),i=/(^|\s)S?(1R20(([+-]\d+)*))(\s|$)/i.$match(u),$(i)?(u=i["$[]"](2),n=i["$[]"](3),r.$debug(n),$(n)&&(n=h("ArithmeticEvaluator").$eval(n)),r.$debug(n),n=n.$to_i(),l=r.$torg_eternity_dice(!1,!1),a=null==(t=R(l))[1]?e:t[1],d=null==t[2]?e:t[2],s=r.$get_torg_eternity_bonus(_=null==t[0]?e:t[0]),o=$(n)?$(k(n,0))?s+"["+d+"]+"+n:s+"["+d+"]"+n:s+"["+d+"]",o=g(o,g(" \uff1e ",g(s,n).$to_s())),T(_,a)&&(o=g(o,g(g("(\u6280\u80fd\u7121",g(r.$get_torg_eternity_bonus(a),n).$to_s()),")"))),o="("+u+") \uff1e "+o):e},1),m(f,"$getRolld20DiceCommandResult",function(u){var t,l,i,r=this,n=e,_=e,a=e,s=e,o=e;return r.$debug("Torg Eternity Dice Roll Command ? ",u),i=/(^|\s)(S)?(TE)$/i.$match(u),$(i)?(l=r.$torg_eternity_dice(!1,!0),n=null==(t=R(l))[0]?e:t[0],_=null==t[1]?e:t[1],a=null==t[2]?e:t[2],C(null==t[3]?e:t[3],1)?s="d20\u30ed\u30fc\u30eb\uff08\u901a\u5e38\uff09 \uff1e 1d20["+a+"] \uff1e Mishap!\u3000\u7d76\u5bfe\u5931\u6557\uff01":(o=r.$format("%+d",r.$get_torg_eternity_bonus(n)),s=T(n,_)?"d20\u30ed\u30fc\u30eb\uff08\u901a\u5e38\uff09 \uff1e 1d20["+a+"] \uff1e "+o+"["+n+"]\uff08\u6280\u80fd\u6709\uff09 / "+r.$format("%+d",r.$get_torg_eternity_bonus(_))+"["+_+"]\uff08\u6280\u80fd\u7121\uff09":"d20\u30ed\u30fc\u30eb\uff08\u901a\u5e38\uff09 \uff1e 1d20["+a+"] \uff1e "+o+"["+n+"]"),s):e},1),m(f,"$getUpRollDiceCommandResult",function(u){var t,l,i,r=this,n=e,_=e,a=e,s=e,y=e,D=e,v=e,S=e,B=e;return r.$debug("Torg Eternity Dice Roll ( UP ) Command ? ",u),i=/(^|\s)(S)?(UP)$/i.$match(u),$(i)?(l=r.$torg_eternity_dice(!1,!0),n=null==(t=R(l))[0]?e:t[0],_=null==t[1]?e:t[1],a=null==t[2]?e:t[2],C(null==t[3]?e:t[3],1)?s="d20\u30ed\u30fc\u30eb\uff08\u9ad8\u63da\uff09 \uff1e 1d20["+a+"] \uff1e Mishap!\u3000\u7d76\u5bfe\u5931\u6557\uff01":(l=r.$torg_eternity_dice(!1,!1),y=null==(t=R(l))[1]?e:t[1],D=null==t[2]?e:t[2],v=g(n,null==t[0]?e:t[0]),S=g(_,y),B=r.$format("%+d",r.$get_torg_eternity_bonus(v)),s=T(v,S)?"d20\u30ed\u30fc\u30eb\uff08\u9ad8\u63da\uff09 \uff1e 1d20["+a+"] + 1d20["+D+"] \uff1e "+B+"["+v+"]\uff08\u6280\u80fd\u6709\uff09 / "+r.$format("%+d",r.$get_torg_eternity_bonus(S))+"["+S+"]\uff08\u6280\u80fd\u7121\uff09":"d20\u30ed\u30fc\u30eb\uff08\u9ad8\u63da\uff09 \uff1e 1d20["+a+"] + 1d20["+D+"] \uff1e "+B+"["+v+"]"),s):e},1),m(f,"$getPossibilityRollDiceCommandResult",function(u){var t,l,r=this,i=e,n=e,a=e,d=e,s=e,o=e,y=e;return r.$debug("Torg Eternity Possibility Roll Command ? ",u),i=/(^|\s)(S)?(POS)((\d+)(\+\d+)?)/i.$match(u),$(i)?(n=h("ArithmeticEvaluator").$eval(i["$[]"](4)),l=r.$torg_eternity_dice(!0,!1),a=null==(t=R(l))[1]?e:t[1],d=null==t[2]?e:t[2],s=g(null==t[0]?e:t[0],n),o=g(a,n),y=r.$format("%+d",r.$get_torg_eternity_bonus(s)),T(s,o)?"d20\u30ed\u30fc\u30eb\uff08\u30dd\u30b7\u30d3\u30ea\u30c6\u30a3\uff09 \uff1e "+n+"+1d20["+d+"] \uff1e "+y+"["+s+"]\uff08\u6280\u80fd\u6709\uff09 / "+r.$format("%+d",r.$get_torg_eternity_bonus(o))+"["+o+"]\uff08\u6280\u80fd\u7121\uff09":"d20\u30ed\u30fc\u30eb\uff08\u30dd\u30b7\u30d3\u30ea\u30c6\u30a3\uff09 \uff1e "+n+"+1d20["+d+"] \uff1e "+y+"["+s+"]"):e},1),m(f,"$getBonusDamageDiceCommandResult",function(u){var t,l,r=this,i=e,n=e,_=e,a=e,d=e,s=e;return r.$debug("TorgEternity Bonus Damage Roll Command ? ",u),i=/(\d+)(BD)(([+\-]\d+)*)/i.$match(u),$(i)?(n=i["$[]"](1).$to_i(),l=r.$get_torg_eternity_modifier(i["$[]"](3)),_=null==(t=R(l))[0]?e:t[0],a=null==t[1]?e:t[1],$(U(n,0))?d="\u30a8\u30e9\u30fc\u3067\u3059\u3002xBD (x\u22671) \u3068\u3057\u3066\u4e0b\u3055\u3044":(l=r.$get_torg_eternity_damage_bonus_dice(n),d="\u30dc\u30fc\u30ca\u30b9\u30c0\u30e1\u30fc\u30b8\u30ed\u30fc\u30eb("+n+"BD"+a+") \uff1e "+(s=null==(t=R(l))[0]?e:t[0])+"["+(null==t[1]?e:t[1])+"]"+a+" \uff1e "+g(s,_)+"\u30c0\u30e1\u30fc\u30b8"),d):e},1),m(f,"$getSuccessLevelDiceCommandResult",function(u){var t=this,l=e,r=e,i=e;return t.$debug("TorgEternity Success Level Table Command ? ",u),l=/(RT|Result)(-*\d+([+\-]\d+)*)/i.$match(u),$(l)?(r=h("ArithmeticEvaluator").$eval(l["$[]"](2)),t.$debug(r),i=$(q(r,0))?"Failure.":t.$get_torg_eternity_success_level(r),t.$debug(i="\u6210\u529f\u30ec\u30d9\u30eb\u8868["+r+"] \uff1e "+i),i):e},1),m(f,"$getDamageResultDiceCommandResult",function(u){var t=this,l=e,r=e,i=e;return t.$debug("TorgEternity Damage Result Table Command ? ",u),l=/(DT|Damage)(-*\d+([+\-]\d+)*)/i.$match(u),$(l)?(r=h("ArithmeticEvaluator").$eval(l["$[]"](2)),t.$debug(r),i=t.$get_torg_eternity_damage_result(r),t.$debug(i="\u30c0\u30e1\u30fc\u30b8\u7d50\u679c\u8868["+r+"] \uff1e "+i),i):e},1),m(f,"$getRollBonusDiceCommandResult",function(u){var t,l,r=this,i=e,n=e,_=e,a=e,d=e,s=e,o=e;return r.$debug("TorgEternity Roll Bonus Table Command ? ",u),i=/(BT|Bonus|Total)(\d+)(([+\-]\d+)*)/i.$match(u),$(i)?(n=i["$[]"](2).$to_i(),_=r.$get_torg_eternity_bonus(n),r.$debug(_),l=r.$get_torg_eternity_modifier(i["$[]"](3)),a=null==(t=R(l))[0]?e:t[0],d=null==t[1]?e:t[1],$(U(n,1))?s="\u30ed\u30fc\u30eb\u30dc\u30fc\u30ca\u30b9\u8868["+n+"] \uff1e Mishap!!":$(d["$empty?"]())?s="\u30ed\u30fc\u30eb\u30dc\u30fc\u30ca\u30b9\u8868["+n+"] \uff1e "+_:(o=g(_.$to_i(),a),r.$debug(o),s="\u30ed\u30fc\u30eb\u30dc\u30fc\u30ca\u30b9\u8868["+n+"]"+d+" \uff1e "+_+"["+n+"]"+d+" \uff1e "+o),r.$debug(s),s):e},1),m(f,"$get_torg_eternity_table_result",function(u,t){var l=e;return l=e,function(){var r=c.new_brk();try{G(t,"each",[],function(n){var _;return null==n&&(n=e),_=n["$[]"](0),$(k(_,u))&&c.brk(e,r),l=n["$[]"](1)},{$$arity:1,$$brk:r})}catch(i){if(i===r)return i.$v;throw i}}(),l},2),m(f,"$get_torg_eternity_modifier",function(u){var t=this,l=e,r=e;return t.$debug("modifier check : "+u),C(u,"")?(l=0,r=""):(l=h("ArithmeticEvaluator").$eval(u),r=t.$format("%+d",l)),t.$debug(l),t.$debug(r),[l,r]},1),m(f,"$torg_eternity_dice",function(u,t){var i=e,n=e,_=e,a=e,d=e,s=e,o=e,y=e;for(i=!0,n=!0,_=0,a=0,d=0,s="";$(i);)$(s["$empty?"]())||(s=g(s,",")),o=this.randomizer.$roll_once(20),$(u)?($(q(o,10))?(y=o+"\u219210",o=10,i=!1):y=o.$to_s(),s=g(s,y)):s=g(s,o.$to_s()),_=g(_,o),$(n)&&(a=g(a,o)),C(o,20)?n=!1:T(o,10)&&(i=!1,n=!1,$(t["$&"](o["$=="](1)))&&(d=1)),u=!1,t=!1;return[_,a,s,d]},2),m(f,"$get_torg_eternity_damage_bonus_dice",function(u){var l=this,r=e,i=e,n=e,_=e;if(l.$debug("bonus dice roll : "+u),r=0,i="",$(k(u,0)))for(r=0,i="";$(k(u,0));)$(i["$empty?"]())||(i+=","),_=(n=l.randomizer.$roll_once(6)).$to_s(),C(n,6)&&(n=5,_="5\u221e",u=g(u,1)),r=g(r,n),i=""+i+_,l.$debug(r),l.$debug(i),u=w(u,1);else i="0";return l.$debug(r),l.$debug(i),[r,i]},1),m(f,"$get_torg_eternity_success_level",function(u){return this.$get_torg_eternity_table_result(u,[[0,"Success - Standard."],[5,"Success - Good!"],[10,"Success - Outstanding!!"]])},1),m(f,"$get_torg_eternity_damage_result",function(u){return this.$get_torg_eternity_table_result(u,[[-50,"\u30ce\u30fc\u30c0\u30e1\u30fc\u30b8"],[-5,"1\u30b7\u30e7\u30c3\u30af"],[0,"2\u30b7\u30e7\u30c3\u30af"],[5,"1\u30ec\u30d9\u30eb\u8ca0\u50b7 + 2\u30b7\u30e7\u30c3\u30af"],[10,"2\u30ec\u30d9\u30eb\u8ca0\u50b7 + 4\u30b7\u30e7\u30c3\u30af"],[15,"3\u30ec\u30d9\u30eb\u8ca0\u50b7 + 6\u30b7\u30e7\u30c3\u30af"],[20,"4\u30ec\u30d9\u30eb\u8ca0\u50b7 + 8\u30b7\u30e7\u30c3\u30af"],[25,"5\u30ec\u30d9\u30eb\u8ca0\u50b7 + 10\u30b7\u30e7\u30c3\u30af"],[30,"6\u30ec\u30d9\u30eb\u8ca0\u50b7 + 12\u30b7\u30e7\u30c3\u30af"],[35,"7\u30ec\u30d9\u30eb\u8ca0\u50b7 + 14\u30b7\u30e7\u30c3\u30af"],[40,"8\u30ec\u30d9\u30eb\u8ca0\u50b7 + 16\u30b7\u30e7\u30c3\u30af"],[45,"9\u30ec\u30d9\u30eb\u8ca0\u50b7 + 18\u30b7\u30e7\u30c3\u30af"],[50,"10\u30ec\u30d9\u30eb\u8ca0\u50b7 + 20\u30b7\u30e7\u30c3\u30af"]])},1),m(f,"$get_torg_eternity_bonus",function(u){var r=e,i=e;return r=this.$get_torg_eternity_table_result(u,[[1,-10],[2,-8],[3,-6],[5,-4],[7,-2],[9,-1],[11,0],[13,1],[15,2],[16,3],[17,4],[18,5],[19,6],[20,7]]),$(k(u,20))&&(i=g(F(w(u,21),5).$to_i(),1),r=g(r,i)),r},1)})}}]);