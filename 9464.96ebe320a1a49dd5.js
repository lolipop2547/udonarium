(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[9464],{9464:(ce,fe,U)=>{U(9993),Opal.queue(function(a){var ie,re,oe,c,A,v,N,w,se,M,I=[],e=a.nil,P=a.module,V=a.klass,q=a.const_set,W=a.send2,X=a.find_super,E=a.range,g=a.def,m=a.eqeqeq,_=a.truthy,B=a.rb_le,b=a.rb_plus,L=a.eqeq,H=a.send,Z=a.rb_times,x=a.rb_ge,T=a.rb_divide,F=a.rb_lt,O=a.rb_gt,ee=a.hash2,S=a.to_ary,p=a.to_a,k=a.rb_minus,te=a.not;return ie=I,re=M=[P(I[0],"BCDice")].concat(ie),w=[P(M[0],"GameSystem")].concat(re),se=a.$r(w),oe=w,A=[c=V(w[0],se("Base"),"Cthulhu7th_ChineseTraditional")].concat(oe),v=a.$r(A),(N=c.$$prototype).bonus_dice_range=N.randomizer=e,q(A[0],"ID","Cthulhu7th:ChineseTraditional"),q(A[0],"NAME","\u514b\u8607\u9b6f\u795e\u8a71\u7b2c7\u7248"),q(A[0],"SORT_KEY","\u56fd\u969b\u5316:Chinese Traditional:\u514b\u8607\u9b6f\u795e\u8a71\u7b2c7\u7248"),q(A[0],"HELP_MESSAGE","\u30fb\u5224\u5b9a\u3000CC(x)<=\uff08\u76ee\u6a19\u5024\uff09\n\u3000x\uff1a\u734e\u52f5\u9ab0/\u61f2\u7f70\u9ab0\uff1aBonus/Penalty Dice (2\uff5e\uff0d2)\u3002\u6c92\u6709\u7684\u8a71\u53ef\u4ee5\u7701\u7565\u3002\n\u3000\u81f4\u547d\u7684\u5931\u6557\uff1aFumble\uff0f\u5931\u6557\uff1aFailure\uff0f\u901a\u5e38\u6210\u529f\uff1aRegular success\uff0f\n\u3000\u56f0\u96e3\u6210\u529f\uff1aHard success\uff0f\u6975\u9650\u6210\u529f\uff1aExtreme success\uff0f\n\u3000\u6c7a\u5b9a\u6027\u7684\u6210\u529f\uff1aCritical success\u3000\u81ea\u52d5\u5224\u5b9a\u3002\n\u4f8b\uff09CC<=30\u3000CC(2)<=50\u3000CC(-1)<=75\n\n\u30fb\u7d44\u5408\u5224\u5b9a\u3000(CBR(x,y))\n\u3000\u9032\u884c\u76ee\u6a19\u5024 x \u548c y \u7684\u5224\u5b9a\u3002\n\u3000\u4f8b\uff09CBR(50,20)\n\n\u30fb\u9023\u5c04\uff08Full Auto\uff09\u5224\u5b9a\u3000FAR(w,x,y,z)\n\u3000w\uff1a\u5f48\u6578(1\uff5e100\uff09\u3001x\uff1a\u6280\u80fd\u5024\uff081\uff5e100\uff09\u3001y\uff1a\u6545\u969c\u7387\n\u3000z\uff1a\u734e\u52f5\u3001\u61f2\u7f70\u9ab0(-2\uff5e2)\u3002\u53ef\u7701\u7565\u3002\n\u3000\u53ea\u8a08\u7b97\u547d\u4e2d\u6578\u3001\u8cab\u7a7f\u6578\u53ca\u5269\u9918\u5f48\u85e5\uff0c\u4e0d\u8a08\u7b97\u50b7\u5bb3\u3002\n\u4f8b\uff09FAR(25,70,98)\u3000FAR(50,80,98,-1)\n\n\u30fb\u760b\u72c2\u8868\n\u30fb\u5be6\u6642\u578b\u3000Short\uff0f\u7e3d\u7d50\u578b\u3000Longer\n"),c.$register_prefix("CC","CBR","FAR"),g(c,"$initialize",function f(l){var i=this;return delete f.$$p,W(i,X(i,"initialize",f,!1,!0),"initialize",[l],null),i.bonus_dice_range=E(-2,2,!1)},1),g(c,"$eval_game_system_specific_command",function(l){var i,t=this;return m(/CC/i,i=l)?t.$getCheckResult(l):m(/CBR/i,i)?t.$getCombineRoll(l):m(/FAR/i,i)?t.$getFullAutoResult(l):e},1),g(c,"$getCheckResult",function(l){var i,n,t=this,$=e,s=e,o=e,u=e,r=e;return _(/^CC([-\d]+)?<=(\d+)/i["$=~"](l)),i=v("Regexp").$last_match(1).$to_i(),n=v("Regexp").$last_match(2).$to_i(),_(B(n,0))?"\u932f\u8aa4\u3002\u76ee\u6a19\u503c\u9700\u70ba1\u4ee5\u4e0a\u3002":_(t.bonus_dice_range["$include?"](i))?($=b($="","(1D100<="+n+")"),$=b($," \u734e\u52f5\u3001\u61f2\u7f70\u9ab0\u5024["+i+"]"),s=t.$rollPercentD10(),o=t.$getTotalLists(i,s),u=t.$getTotal(o,i),r=t.$getCheckResultText(u,n),$=b($," \uff1e "+o.$join(", ")+" \uff1e "+u+" \uff1e "+r)):"\u932f\u8aa4\u3002\u734e\u52f5\u3001\u61f2\u7f70\u9ab0\u5024\u70ba"+t.bonus_dice_range.$min()+"\uff5e"+t.bonus_dice_range.$max()+"\u3002"},1),g(c,"$rollPercentD10",function(){var t=e;return t=this.randomizer.$roll_once(10),L(t,10)&&(t=0),t},0),g(c,"$getTotalLists",function(l,t){var $,n=e;return n=[],$=b(1,l.$abs()),H($,"times",[],function s(){var u,r=e;return u=(null==s.$$s?this:s.$$s).$rollPercentD10(),r=b(Z(u,10),t),L(r,0)&&(r=100),n.$push(r)},{$$arity:0,$$s:this}),n},2),g(c,"$getTotal",function(l,t){return _(x(t,0))?l.$min():l.$max()},2),g(c,"$getCheckResultText",function(l,t,i){var n;if(null==i&&(i=!1),_(B(l,t)))return L(l,1)?"\u6c7a\u5b9a\u6027\u7684\u6210\u529f":_(B(l,T(t,5).$to_i()))?"\u6975\u9650\u7684\u6210\u529f":_(B(l,T(t,2).$to_i()))?"\u56f0\u96e3\u7684\u6210\u529f":"\u901a\u5e38\u6210\u529f";if(n="\u81f4\u547d\u7684\u5931\u6557",L(l,100))return n;if(_(x(l,96))){if(_(F(t,50)))return n;if(_(i))return n}return"\u5931\u6557"},-3),g(c,"$getCombineRoll",function(l){var t=this,i=e,n=e,$=e,s=e,o=e,u=e,r=e;return _(/CBR\((\d+),(\d+)\)/i["$=~"](l))?(i=v("Regexp").$last_match(1).$to_i(),n=v("Regexp").$last_match(2).$to_i(),$=t.randomizer.$roll_once(100),s=t.$getCheckResultText($,i),o=t.$getCheckResultText($,n),r=0,_((u=["\u6c7a\u5b9a\u6027\u7684\u6210\u529f","\u6975\u9650\u7684\u6210\u529f","\u56f0\u96e3\u7684\u6210\u529f","\u901a\u5e38\u6210\u529f"])["$include?"](s))&&(r=b(r,1)),_(u["$include?"](o))&&(r=b(r,1)),t.$debug("succesCount",r),"(1d100<="+i+","+n+") \uff1e "+$+"["+s+","+o+"] \uff1e "+(_(x(r,2))?"\u6210\u529f":L(r,1)?"\u90e8\u5206\u7684\u6210\u529f":"\u5931\u6557")):e},1),g(c,"$getFullAutoResult",function(l){var t=this,i=e,n=e,$=e,s=e,o=e,u=e,r=e;return _(/^FAR\((-?\d+)(,(-?\d+))(,(-?\d+))(,(-?\d+))?\)/i["$=~"](l))?(i=v("Regexp").$last_match(1).$to_i(),n=v("Regexp").$last_match(3).$to_i(),$=v("Regexp").$last_match(5).$to_i(),s=(_(o=v("Regexp").$last_match(7))?o:0).$to_i(),u="",_(O(i,r=100))&&(u=b(u,"\n\u5f48\u85e5\u592a\u591a\u3002\u8acb\u6539\u88dd\u586b"+r+"\u767c\u3002\n"),i=r),_(B(i,0))?"\u6b63\u78ba\u88dd\u586b\u6578\u3002":_(B(n,0))?"\u6b63\u78ba\u76ee\u6a19\u503c\u3002":(_(F($,0))&&(u=b(u,"\n\u6b63\u78ba\u6545\u969c\u503c\u3002\u6392\u9664\u734e\u52f5\u8a18\u865f\u3002\n"),$=$.$abs()),_(t.bonus_dice_range["$include?"](s))?(u=b(u,"\u734e\u52f5\u3001\u61f2\u7f70\u9ab0\u5024["+s+"]"),u=b(u,t.$rollFullAuto(i,n,$,s))):"\n\u932f\u8aa4\u3002\u734e\u52f5\u3001\u61f2\u7f70\u9ab0\u5024\u70ba"+t.bonus_dice_range.$min()+"\uff5e"+t.bonus_dice_range.$max()+"\u3067\u3059\u3002")):e},1),g(c,"$rollFullAuto",function(l,t,i,n){try{var s=e,o=e,u=e;return s="",o=0,u=ee(["hit_bullet","impale_bullet","bullet"],{hit_bullet:0,impale_bullet:0,bullet:l}),H(E(0,3,!1),"each",[],function r(R){var h,y,C=null==r.$$s?this:r.$$s,z=e,j=e,K=e,Y=e,J=e,Q=e,d=e;for(null==C.bonus_dice_range&&(C.bonus_dice_range=e),null==R&&(R=e),s=b(s,C.$getNextDifficltyMessage(R));_(x(n,C.bonus_dice_range.$min()));)o=b(o,1),y=C.$getHitResultInfos(n,t,R),z=null==(h=S(y))[0]?e:h[0],j=null==h[1]?e:h[1],s=b(s,"\n"+o+"\u6b21: \uff1e "+(null==h[2]?e:h[2]).$join(", ")+" \uff1e "+z),_(x(j,i))&&(s=b(s,"\u5361\u5f48"),a.ret(C.$getHitResultText(s,u))),K=C.$getHitType(R,z),y=C.$getBulletResults(u["$[]"]("bullet"),K,t),Y=null==(h=S(y))[0]?e:h[0],J=null==h[1]?e:h[1],Q=null==h[2]?e:h[2],d=["hit_bullet",b(u["$[]"]("hit_bullet"),Y)],H(u,"[]=",p(d)),k(d.length,1),d=["impale_bullet",b(u["$[]"]("impale_bullet"),J)],H(u,"[]=",p(d)),k(d.length,1),d=["bullet",k(u["$[]"]("bullet"),Q)],H(u,"[]=",p(d)),k(d.length,1),_(B(u["$[]"]("bullet"),0))&&a.ret(C.$getHitResultText(s,u)),n=k(n,1);return n=b(n,1)},{$$arity:1,$$s:this}),this.$getHitResultText(s,u)}catch(r){if(r===a.returner)return r.$v;throw r}},4),g(c,"$getHitResultInfos",function(l,t,i){var $,s,o,u,n=this;return $=n.$rollPercentD10(),s=n.$getTotalLists(l,$),o=n.$getTotal(s,l),u=n.$getFumbleable(i),[n.$getCheckResultText(o,t,u),o,s]},3),g(c,"$getHitResultText",function(l,t){return l+"\n\uff1e "+t["$[]"]("hit_bullet")+"\u767c\u5c04\u64ca\u547d\u4e2d\u3001"+t["$[]"]("impale_bullet")+"\u5c04\u64ca\u8cab\u7a7f\u3001\u5269\u9918\u5f48\u85e5"+t["$[]"]("bullet")+"\u767c"},2),g(c,"$getHitType",function(l,t){var i,n,o=e;return n=this.$getSuccessListImpaleBulletList(l),o=null==(i=S(n))[1]?e:i[1],_((null==i[0]?e:i[0])["$include?"](t))?"hit":_(o["$include?"](t))?"impale":""},2),g(c,"$getBulletResults",function(l,t,i){var $,s,n=this,o=e,u=e,r=e,R=e,D=e,h=e;return $=n.$getSetOfBullet(i),s=n.$getHitBulletCountBase(i,$),o=T($,2..$to_f()),u=0,r=0,R=0,te(n.$isLastBulletTurn(l,$))?(m("hit",D=t)?r=s:m("impale",D)&&(r=o.$floor(),R=o.$ceil()),u=$):(m("hit",D=t)?r=n.$getLastHitBulletCount(l):m("impale",D)&&(r=(h=T(l,2..$to_f())).$floor(),R=h.$ceil()),u=l),[r,R,u]},3),g(c,"$getSuccessListImpaleBulletList",function(l){var n,t=e,i=e;return t=[],i=[],m(0,n=l)?(t=["\u56f0\u96e3\u7684\u6210\u529f","\u901a\u5e38\u6210\u529f"],i=["\u6c7a\u5b9a\u6027\u7684\u6210\u529f","\u6975\u9650\u7684\u6210\u529f"]):m(1,n)?(t=["\u56f0\u96e3\u7684\u6210\u529f"],i=["\u6c7a\u5b9a\u6027\u7684\u6210\u529f","\u6975\u9650\u7684\u6210\u529f"]):m(2,n)?(t=[],i=["\u6c7a\u5b9a\u6027\u7684\u6210\u529f","\u6975\u9650\u7684\u6210\u529f"]):m(3,n)&&(t=["\u6c7a\u5b9a\u6027\u7684\u6210\u529f"],i=[]),[t,i]},1),g(c,"$getNextDifficltyMessage",function(l){var t;return m(1,t=l)?"\n    \u8b8a\u66f4\u96e3\u5ea6\u70ba\u56f0\u96e3\u7684\u6210\u529f":m(2,t)?"\n    \u8b8a\u66f4\u96e3\u5ea6\u70ba\u6975\u9650\u7684\u6210\u529f":m(3,t)?"\n    \u8b8a\u66f4\u96e3\u5ea6\u70ba\u6c7a\u5b9a\u6027\u7684\u6210\u529f":""},1),g(c,"$getSetOfBullet",function(l){var t=e;return t=T(l,10).$to_i(),_(x(l,1))&&_(F(l,10))&&(t=1),t},1),g(c,"$getHitBulletCountBase",function(l,t){var i=e;return i=T(t,2).$to_i(),_(x(l,1))&&_(F(l,10))&&(i=1),i},2),g(c,"$isLastBulletTurn",function(l,t){return F(k(l,t),0)},2),g(c,"$getLastHitBulletCount",function(l){return L(l,1)?1:T(l,2..$to_f()).$floor()},1),g(c,"$getFumbleable",function(l){return x(l,1)},1)})}}]);