(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[6698],{6698:(de,me,fe)=>{fe(9993),Opal.modules["i18n/backend/fallbacks"]=function(r){var U,a,L,N,I,f,M=[],t=r.nil,m=r.$$$,e=r.module,p=r.class_variable_set,E=r.truthy,A=r.class_variable_get,s=r.def,C=r.send,Y=r.to_a,S=r.rb_minus,z=r.send2,F=r.find_super,H=r.hash2,B=r.find_block_super,j=r.neqeq;return U=M,f=[I=e(M[0],"I18n")].concat(U),p(f[0],"@@fallbacks",t),a=r.get_singleton_class(I),L=[a].concat(f),N=r.$r(L),s(a,"$fallbacks",function(){var g=t;return p(L[1],"@@fallbacks",E(null!=L[1].$$cvars["@@fallbacks"]?"class variable":t)&&E(g=A(L[1],"@@fallbacks",!1))?g:m(m(N("I18n"),"Locale"),"Fallbacks").$new()),E(g=N("Thread").$current()["$[]"]("i18n_fallbacks"))?g:A(L[1],"@@fallbacks",!1)},0),s(a,"$fallbacks=",function(h){var g;return p(L[1],"@@fallbacks",E(h["$is_a?"](N("Array")))?m(m(N("I18n"),"Locale"),"Fallbacks").$new(h):h),g=["i18n_fallbacks",A(L[1],"@@fallbacks",!1)],C(N("Thread").$current(),"[]=",Y(g)),g[S(g.length,1)]},1),function(a,q){var h,g,y,c,N=[e(a,"Backend")].concat(q);return h=N,y=[g=e(N[0],"Fallbacks")].concat(h),c=r.$r(y),s(g,"$translate",function _(l,$,u){try{var n=_.$$p||t,i=this,d=t,x=t;return delete _.$$p,null==u&&(u=c("EMPTY_HASH")),E(u.$fetch("fallback",!0))?E(u["$[]"]("fallback_in_progress"))?z(i,F(i,"translate",_,!1,!0),"translate",[l,$,u],n):(E(u["$[]"]("default"))&&(d=i["$extract_non_symbol_default!"](u)),x=u.$merge(H(["fallback_in_progress"],{fallback_in_progress:!0})),C(c("I18n").$fallbacks()["$[]"](l),"each",[],function v(T){var P=null==v.$$s?this:v.$$s;null==T&&(T=t);try{return C(P,"catch",["exception"],function G(){var o=null==G.$$s?this:G.$$s,Z=t;if(Z=z(o,B(o,"translate",G.$$def||v.$$def||_,!1,!1),"translate",[T,$,x],null),E(Z["$nil?"]()))return t;j(l.$to_s(),T.$to_s())&&o.$on_fallback(l,T,$,u),r.ret(Z)},{$$arity:0,$$s:P})}catch(G){if(!r.rescue(G,[m(c("I18n"),"InvalidLocale")]))throw G;try{return t}finally{r.pop_exception()}}},{$$arity:1,$$s:i}),E(u["$key?"]("default"))&&E(u["$[]"]("default")["$nil?"]())?t:E(d)?z(i,F(i,"translate",_,!1,!0),"translate",[l,t,u.$merge(H(["default"],{default:d}))],null):i.$throw("exception",m(c("I18n"),"MissingTranslation").$new(l,$,u))):z(i,F(i,"translate",_,!1,!0),"translate",[l,$,u],n)}catch(v){if(v===r.returner)return v.$v;throw v}},-3),s(g,"$extract_non_symbol_default!",function(l){var u,$=t,n=t;return $=[l["$[]"]("default")].$flatten(),u=C($,"detect",[],function(d){return null==d&&(d=t),d["$is_a?"](c("Symbol"))["$!"]()},1),E(u)&&(n=["default",$["$[]"](0,$.$index(u))],C(l,"[]=",Y(n)),S(n.length,1)),u},1),s(g,"$exists?",function _(l,$,u){try{var n=_.$$p||t,i=this;return delete _.$$p,null==u&&(u=c("EMPTY_HASH")),E(u.$fetch("fallback",!0))?(C(c("I18n").$fallbacks()["$[]"](l),"each",[],function d(x){var v=null==d.$$s?this:d.$$s;null==x&&(x=t);try{if(!E(z(v,B(v,"exists?",d.$$def||_,!1,!1),"exists?",[x,$],null)))return t;r.ret(!0)}catch(T){if(!r.rescue(T,[m(c("I18n"),"InvalidLocale")]))throw T;try{return t}finally{r.pop_exception()}}},{$$arity:1,$$s:i}),!1):z(i,F(i,"exists?",_,!1,!0),"exists?",[l,$,u],n)}catch(d){if(d===r.returner)return d.$v;throw d}},-3),g.$private(),s(g,"$on_fallback",function(l,$,u,n){return t},4)}(f[0],f)},Opal.modules["bcdice/randomizer"]=function(r){var I,b,h,g,y,c,a,q,M=[],t=r.nil,m=r.$$$,p=r.klass,E=r.const_set,A=r.def,s=r.truthy,C=r.rb_gt,Y=r.rb_plus,S=r.rb_le,z=r.send,F=r.rb_minus,H=r.eqeq,B=r.rb_times,j=r.eqeqeq,V=r.rb_ge;return I=M,a=[(0,r.module)(M[0],"BCDice")].concat(I),q=r.$r(a),b=a,g=[h=p(a[0],null,"Randomizer")].concat(b),y=r.$r(g),(c=h.$$prototype).rand_results=c.detailed_rand_results=t,E(g[0],"UPPER_LIMIT_DICE_TIMES",200),E(g[0],"UPPER_LIMIT_DICE_SIDES",1e3),E(g[0],"UPPER_LIMIT_RANDS",1e4),A(h,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]},0),h.$attr_reader("rand_results"),h.$attr_reader("detailed_rand_results"),E(g[0],"DetailedRandResult",y("Struct").$new("kind","sides","value")),A(h,"$roll_barabara",function(l,$){var u=this;return s(C(Y(u.rand_results.$size(),l),y("UPPER_LIMIT_RANDS")))&&u.$raise(y("TooManyRandsError")),s(S(l,0))||s(C(l,y("UPPER_LIMIT_DICE_TIMES")))?[]:z(y("Array"),"new",[l],function n(){return(null==n.$$s?this:n.$$s).$roll_once($)},{$$arity:0,$$s:u})},2),A(h,"$roll_sum",function(l,$){return this.$roll_barabara(l,$).$sum()},2),A(h,"$roll_once",function(l){var u=t;return s(S(l,0))||s(C(l,y("UPPER_LIMIT_DICE_SIDES")))?0:(u=this.$rand_inner(l),this.$push_to_detail("normal",l,u),u)},1),A(h,"$roll_index",function(l){return F(this.$roll_once(l),1)},1),A(h,"$roll_tens_d10",function(){var u,$=t;return $=this.$rand_inner(10),H($,10)&&($=0),u=B($,10),this.$push_to_detail("tens_d10",10,u),u},0),A(h,"$roll_d9",function(){var $;return $=F(this.$rand_inner(10),1),this.$push_to_detail("d9",10,$),$},0),A(h,"$roll_d66",function(l){var n,u=t;return u=z(y("Array"),"new",[2],function i(){return(null==i.$$s?this:i.$$s).$roll_once(6)},{$$arity:0,$$s:this}),j(m(y("D66SortType"),"ASC"),n=l)?u["$sort!"]():j(m(y("D66SortType"),"DESC"),n)&&u["$sort!"]()["$reverse!"](),Y(B(u["$[]"](0),10),u["$[]"](1))},1),h.$private(),A(h,"$rand_inner",function(l){var u,$=this;return s(V($.rand_results.$size(),y("UPPER_LIMIT_RANDS")))&&$.$raise(y("TooManyRandsError")),u=$.$random(l),$.rand_results["$<<"]([u,l]),u},1),A(h,"$random",function(l){return Y(y("Kernel").$rand(l),1)},1),A(h,"$push_to_detail",function(l,$,u){var i;return i=y("DetailedRandResult").$new(l,$,u),this.detailed_rand_results.$push(i)},3),p(a[0],q("StandardError"),"TooManyRandsError"),t},Opal.modules["bcdice/dice_table/roll_result"]=function(r){var s,z,V,U,I,f,a,H,Y,M=[],t=r.nil,m=r.module,e=r.klass,p=r.def,E=r.truthy;return s=M,z=Y=[m(M[0],"BCDice")].concat(s),V=H=[m(Y[0],"DiceTable")].concat(z),I=[U=e(H[0],null,"RollResult")].concat(V),f=r.$r(I),(a=U.$$prototype).table_name=a.value=a.body=t,p(U,"$initialize",function(L,N,b){var h=this;return h.table_name=L,h.value=N,h.body=b},3),U.$attr_reader("table_name"),U.$attr_reader("value"),U.$attr_reader("body"),p(U,"$to_s",function(){var L=this;return L.table_name+"("+L.value+") \uff1e "+L.body},0),p(U,"$last_body",function(){var L=this;return E(L.body["$is_a?"](f("RollResult")))?L.body.$last_body():L.body},0),p(U,"$empty?",function(){return!1},0)},Opal.modules["bcdice/dice_table/chain_table"]=function(r){var C,F,U,I,f,a,q,B,S,M=[],t=r.nil,m=r.module,e=r.klass,p=r.truthy,E=r.def,A=r.rb_minus;return C=M,F=S=[m(M[0],"BCDice")].concat(C),U=B=[m(S[0],"DiceTable")].concat(F),f=[I=e(B[0],null,"ChainTable")].concat(U),a=r.$r(f),(q=I.$$prototype).times=q.sides=q.items=q.name=t,E(I,"$initialize",function(N,b,h){var g=this,y=t;return g.name=N,g.items=h.$freeze(),y=/(\d+)D(\d+)/i.$match(b),p(y)||g.$raise(a("ArgumentError"),"Unexpected table type: "+b),g.times=y["$[]"](1).$to_i(),g.sides=y["$[]"](2).$to_i()},3),E(I,"$roll",function(N){var h,g,b=this,y=t;return h=N.$roll_sum(b.times,b.sides),g=A(h,b.times),y=b.items["$[]"](g),p(y["$respond_to?"]("roll"))&&(y=y.$roll(N)),a("RollResult").$new(b.name,h,y)},1)},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(r){var z,j,a,q,L,N,b,U,H,M=[],t=r.nil,m=r.module,e=r.klass,p=r.hash2,E=r.defs,A=r.def,s=r.rb_plus,C=r.rb_times,Y=r.rb_minus;return z=M,j=H=[m(M[0],"BCDice")].concat(z),a=U=[m(H[0],"DiceTable")].concat(j),L=[q=e(U[0],null,"D66GridTable")].concat(a),N=r.$r(L),(b=q.$$prototype).name=b.items=t,E(q,"$from_i18n",function(g,y){var _=t;return _=N("I18n").$t(g,p(["locale","raise"],{locale:y,raise:!0})),this.$new(_["$[]"]("name"),_["$[]"]("items"))},2),A(q,"$initialize",function(g,y){return this.name=g,this.items=y.$freeze()},2),A(q,"$roll",function(g){var c,_,l,$,u;return c=g.$roll_once(6),_=g.$roll_once(6),l=s(C(c,10),_),$=Y(c,1),u=Y(_,1),N("RollResult").$new(this.name,l,this.items["$[]"]($)["$[]"](u))},1)},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(r){var Y,H,f,a,q,L,j,V,z,t=[],m=r.nil,e=r.module,p=r.klass,E=r.hash2,A=r.defs,s=r.def;return r.top.$require("bcdice/dice_table/d66_grid_table"),Y=t,H=z=[e(t[0],"BCDice")].concat(Y),j=[e(z[0],"DiceTable")].concat(H),V=r.$r(j),f=j,q=[a=p(j[0],V("D66GridTable"),"D66HalfGridTable")].concat(f),L=r.$r(q),A(a,"$from_i18n",function(b,h){var y=m;return y=L("I18n").$t(b,E(["locale","raise"],{locale:h,raise:!0})),this.$new(y["$[]"]("name"),y["$[]"]("items_1_2_3"),y["$[]"]("items_4_5_6"))},2),s(a,"$initialize",function(b,h,g){return this.name=b,this.items=[h,h,h,g,g,g].$freeze()},3)},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(r){var Y,H,f,a,q,L,j,V,z,t=[],m=r.nil,e=r.module,p=r.klass,E=r.hash2,A=r.defs,s=r.def;return r.top.$require("bcdice/dice_table/d66_grid_table"),Y=t,H=z=[e(t[0],"BCDice")].concat(Y),j=[e(z[0],"DiceTable")].concat(H),V=r.$r(j),f=j,q=[a=p(j[0],V("D66GridTable"),"D66OneThirdTable")].concat(f),L=r.$r(q),A(a,"$from_i18n",function(b,h){var y=m;return y=L("I18n").$t(b,E(["locale","raise"],{locale:h,raise:!0})),this.$new(y["$[]"]("name"),y["$[]"]("items_1_2"),y["$[]"]("items_3_4"),y["$[]"]("items_5_6"))},2),s(a,"$initialize",function(b,h,g,y){return this.name=b,this.items=[h,h,g,g,y,y].$freeze()},4)},Opal.modules["bcdice/dice_table/d66_table"]=function(r){var H,U,L,N,b,h,g,f,j,M=[],t=r.nil,m=r.$$$,e=r.module,p=r.klass,E=r.hash2,A=r.defs,s=r.def,C=r.eqeqeq,Y=r.rb_plus,S=r.rb_times,z=r.truthy;return H=M,U=j=[e(M[0],"BCDice")].concat(H),L=f=[e(j[0],"DiceTable")].concat(U),b=[N=p(f[0],null,"D66Table")].concat(L),h=r.$r(b),(g=N.$$prototype).sort_type=g.items=g.name=t,A(N,"$from_i18n",function(c,_){var u,$=t;return $=h("I18n").$t(c,E(["locale"],{locale:_})),u=h("D66SortType").$const_get($["$[]"]("d66_sort_type")),this.$new($["$[]"]("name"),u,$["$[]"]("items"))},2),s(N,"$initialize",function(c,_,l){var $=this;return $.name=c,$.sort_type=_,$.items=l.$freeze()},3),s(N,"$roll",function(c){var _=this,l=t,$=t,u=t,n=t;return l=c.$roll_barabara(2,6),C(m(h("D66SortType"),"ASC"),$=_.sort_type)?l["$sort!"]():C(m(h("D66SortType"),"DESC"),$)&&l["$sort!"]()["$reverse!"](),u=Y(S(l["$[]"](0),10),l["$[]"](1)),n=z($=_.items["$[]"](u))?$:_.items["$[]"](u.$to_s()),z(n["$respond_to?"]("roll"))&&(n=n.$roll(c)),h("RollResult").$new(_.name,u,n)},1),s(N,"$choice",function(c){return h("RollResult").$new(this.name,c,this.items["$[]"](c))},1)},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(r){var V,a,L,N,I,t=[],m=r.nil,e=r.module,p=r.klass,E=r.hash2,A=r.send,s=r.to_ary,C=r.rb_plus,Y=r.rb_times,S=r.to_a,z=r.rb_minus,F=r.send2,H=r.find_super,B=r.def;return r.top.$require("bcdice/dice_table/d66_table"),V=t,a=I=[e(t[0],"BCDice")].concat(V),L=[e(I[0],"DiceTable")].concat(a),N=r.$r(L),B(p(L[0],N("D66Table"),"D66LeftRangeTable"),"$initialize",function y(c,_,l){var n;return delete y.$$p,n=E([],{}),A(l,"each",[],function(d){var x,P;return null==d&&(d=m),x=s(d),P=null==x[1]?m:x[1],A(null==x[0]?m:x[0],"each",[],function(o){return null==o&&(o=m),A(P,"each_with_index",[],function(k,O){var $e,ne;return null==k&&(k=m),null==O&&(O=m),$e=C(Y(o,10),C(O,1)),A(n,"[]=",S(ne=[$e,k])),ne[z(ne.length,1)]},2)},1)},1),F(this,H(this,"initialize",y,!1,!0),"initialize",[c,_,n],null)},3)},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(r){var S,B,f,a,q,L,N,V,F,M=[],t=r.nil,m=r.module,e=r.klass,p=r.def,E=r.truthy,A=r.rb_minus,s=r.rb_plus,C=r.rb_times;return S=M,B=F=[m(M[0],"BCDice")].concat(S),f=V=[m(F[0],"DiceTable")].concat(B),q=[a=e(V[0],null,"D66ParityTable")].concat(f),L=r.$r(q),(N=a.$$prototype).odd=N.even=N.name=t,p(a,"$initialize",function(h,g,y){var c=this;return c.name=h,c.odd=g.$freeze(),c.even=y.$freeze()},3),p(a,"$roll",function(h){var c,l,$,g=this,y=t;return y=h.$roll_once(6),c=h.$roll_once(6),l=(E(y["$odd?"]())?g.odd:g.even)["$[]"](A(c,1)),$=s(C(y,10),c),L("RollResult").$new(g.name,$,l)},1)},Opal.modules["bcdice/dice_table/d66_range_table"]=function(r){var Y,H,I,f,a,q,L,j,z,M=[],t=r.nil,m=r.module,e=r.klass,p=r.def,E=r.rb_plus,A=r.rb_times,s=r.send;return Y=M,H=z=[m(M[0],"BCDice")].concat(Y),I=j=[m(z[0],"DiceTable")].concat(H),a=[f=e(j[0],null,"D66RangeTable")].concat(I),q=r.$r(a),(L=f.$$prototype).items=L.name=t,p(f,"$initialize",function(b,h){return this.name=b,this.items=h.$freeze()},2),p(f,"$roll",function(b){var g,y,c,_=t;return g=b.$roll_once(6),y=b.$roll_once(6),c=E(A(g,10),y),_=s(this.items,"find",[],function($){return null==$&&($=t),$["$[]"](0)["$include?"](c)},1),q("RollResult").$new(this.name,c,_["$[]"](1))},1)},Opal.modules["bcdice/dice_table/range_table"]=function(r){var B,I,N,b,h,g,y,a,V,M=[],t=r.nil,m=r.module,e=r.klass,p=r.const_set,E=r.send,A=r.truthy,s=r.def,C=r.to_a,Y=r.rb_minus,S=r.eqeqeq,z=r.rb_times,F=r.rb_plus;return B=M,I=V=[m(M[0],"BCDice")].concat(B),N=a=[m(V[0],"DiceTable")].concat(I),h=[b=e(a[0],null,"RangeTable")].concat(N),g=r.$r(h),(y=b.$$prototype).name=y.items=y.num_of_dice=y.num_of_sides=y.formatter=t,p(h[0],"RollResult",E(g("Struct"),"new",["sum","values","content","formatted"],function c(){return(null==c.$$s?this:c.$$s).$alias_method("to_s","formatted")},{$$arity:0,$$s:b})),p(h[0],"Item",g("Struct").$new("range","content")),p(h[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),p(h[0],"DEFAULT_FORMATTER",E(b,"lambda",[],function(_,l){return null==_&&(_=t),null==l&&(l=t),_.$name()+"("+l.$sum()+") \uff1e "+l.$content()},2)),b.$attr_reader("name"),b.$attr_reader("num_of_dice"),b.$attr_reader("num_of_sides"),s(b,"$initialize",function c(_,l,$){var i,u=c.$$p||t,n=this,d=t;return delete c.$$p,n.name=_.$freeze(),n.formatter=A(i=u)?i:g("DEFAULT_FORMATTER"),d=g("DICE_ROLL_METHOD_RE").$match(l),A(d)||n.$raise(g("ArgumentError"),n.name+": invalid dice roll method: "+l),n.num_of_dice=d["$[]"](1).$to_i(),n.num_of_sides=d["$[]"](2).$to_i(),n.$store($)},3),s(b,"$fetch",function(_){var $,l=this;return $=E(l.items,"find",[],function(n){return null==n&&(n=t),n.$range()["$include?"](_)},1),A($)||l.$raise(g("RangeError"),l.name+": value is out of range: "+_),$},1),s(b,"$roll",function(_){var u,n,i,l=this,$=t;return u=($=_.$roll_barabara(l.num_of_dice,l.num_of_sides)).$sum(),n=g("RollResult").$new(u,$,l.$fetch(u).$content()),i=[l.formatter["$[]"](l,n)],E(n,"formatted=",C(i)),Y(i.length,1),n},1),b.$private(),s(b,"$store",function(_){var $,u,l=this;return $=E(_,"map",[],function n(i,d){return null==i&&(i=t),null==d&&(d=t),[(null==n.$$s?this:n.$$s).$coerce_to_int_range(i),d]},{$$arity:2,$$s:l}),u=E($,"sort_by",[],function(i,d){return null==i&&(i=t),null==d&&(d=t),i.$min()},2),l.$assert_min_sum_is_covered(u),l.$assert_max_sum_is_covered(u),l.$assert_no_gap_or_overlap_in_ranges(u),l.items=E(u,"map",[],function(i,d){return null==i&&(i=t),null==d&&(d=t),g("Item").$new(i,d.$freeze()).$freeze()},2).$freeze(),l},1),s(b,"$coerce_to_int_range",function(_){var $;return S(g("Integer"),$=_)?g("Range").$new(_,_):S(g("Range"),$)&&A(_.$begin()["$is_a?"](g("Integer")))&&A(_.$end()["$is_a?"](g("Integer")))?_:this.$raise(g("TypeError"),this.name+": "+_+" ("+_.$class()+") must be an Integer or a Range with Integers ")},1),s(b,"$assert_min_sum_is_covered",function(_){var $,l=this,u=t;return $=l.num_of_dice,u=_.$first()["$[]"](0),A(u["$include?"]($))||l.$raise(g("RangeError"),l.name+": min value ("+$+") is not covered: "+u),l},1),s(b,"$assert_max_sum_is_covered",function(_){var $,l=this,u=t;return $=z(l.num_of_dice,l.num_of_sides),u=_.$last()["$[]"](0),A(u["$include?"]($))||l.$raise(g("RangeError"),l.name+": max value ("+$+") is not covered: "+u),l},1),s(b,"$assert_no_gap_or_overlap_in_ranges",function(_){return E(_,"each_cons",[2],function $(u,n){var v,T,i=null==$.$$s?this:$.$$s,d=t,x=t;return null==i.name&&(i.name=t),null==u&&(u=t),null==n&&(n=t),d=u["$[]"](0),x=n["$[]"](0),v=d.$max(),T=F(v,1),A(x["$include?"](v))&&i.$raise(g("RangeError"),i.name+": Range overlap: "+d+" and "+x),A(x["$include?"](T))?t:i.$raise(g("RangeError"),i.name+": Range gap: "+d+" and "+x)},{$$arity:2,$$s:this}),this},1)},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(r){var Y,H,I,N,b,h,g,a,j,z,M=[],t=r.nil,m=r.$$$,e=r.module,p=r.klass,E=r.send,A=r.def,s=r.rb_minus;return Y=M,H=z=[e(M[0],"BCDice")].concat(Y),I=j=[e(z[0],"DiceTable")].concat(H),N=a=[p(j[0],null,"SaiFicSkillTable")].concat(I),h=[b=p(a[0],null,"Category")].concat(N),g=r.$r(h),b.$$prototype.name=t,A(b,"$initialize",function(_,l,$,u){var n=this;return n.name=_,n.skills=E(l.$map(),"with_index",[2],function(d,x){return null==d&&(d=t),null==x&&(x=t),m(g("SaiFicSkillTable"),"Skill").$new(_,d,$,x,u)},2),n.dice=$},4),A(b,"$roll",function(_){return this.$skills()["$[]"](s(_.$roll_sum(2,6),2))},1),A(b,"$to_s",function(){return this.name},0),b.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(r){var s,z,V,q,L,I,H,Y,M=[],t=r.nil,m=r.module,e=r.klass,p=r.def,E=r.hash2;return s=M,z=Y=[m(M[0],"BCDice")].concat(s),V=H=[m(Y[0],"DiceTable")].concat(z),I=[e(H[0],null,"SaiFicSkillTable")].concat(V),(L=(q=e(I[0],null,"Skill")).$$prototype).s_format=L.category_dice=L.row_dice=L.category_name=L.name=t,p(q,"$initialize",function(b,h,g,y,c){var _=this;return _.category_name=b,_.name=h,_.category_dice=g,_.row_dice=y,_.s_format=c},5),p(q,"$to_s",function(){var b=this;return b.$format(b.s_format,E(["category_dice","row_dice","category_name","skill_name"],{category_dice:b.category_dice,row_dice:b.row_dice,category_name:b.category_name,skill_name:b.name}))},0),q.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(r){var U,q,g,y,c,_,l,N,f,M=r.top,t=[],m=r.nil,e=r.$$$,p=r.module,E=r.klass,A=r.hash2,s=r.send,Y=r.defs,S=r.const_set,z=r.to_ary,F=r.def,H=r.truthy,B=r.rb_minus,j=r.rb_plus;return M.$require("bcdice/dice_table/sai_fic_skill_table/category"),M.$require("bcdice/dice_table/sai_fic_skill_table/skill"),U=t,q=f=[p(t[0],"BCDice")].concat(U),g=N=[p(f[0],"DiceTable")].concat(q),c=[y=E(N[0],null,"SaiFicSkillTable")].concat(g),_=r.$r(c),(l=y.$$prototype).rtt=l.rtt_format=l.rct=l.rct_format=l.rttn=l.rttn_format=l.categories=m,Y(y,"$from_i18n",function(u,n,i){var d,x,v,o,G=m;if(null==i)i=A([],{});else if(!i.$$is_hash)throw r.ArgumentError.$new("expected kwargs");return null==(d=i.$$smap.rtt)&&(d=m),null==(x=i.$$smap.rct)&&(x=m),null==(v=i.$$smap.rttn)&&(v=m),o=(G=_("I18n").$t("RTT",A(["locale","raise","default"],{locale:n,raise:!1,default:A([],{})})).$merge(_("I18n").$t(u,A(["locale","raise"],{locale:n,raise:!0}))))["$[]"]("items"),G=s(G,"select",[],function(k,O){return null==k&&(k=m),null==O&&(O=m),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](k)},2),this.$new(o,r.to_hash(G).$merge(A(["rtt","rct","rttn"],{rtt:d,rct:x,rttn:v})))},-3),S(c[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),S(c[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),S(c[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),S(c[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),F(y,"$initialize",function(u,n){var i,d,x,v,T,P,G,o=this;if(null==n)n=A([],{});else if(!n.$$is_hash)throw r.ArgumentError.$new("expected kwargs");return null==(i=n.$$smap.rtt)&&(i=m),null==(d=n.$$smap.rct)&&(d=m),null==(x=n.$$smap.rttn)&&(x=m),null==(v=n.$$smap.rtt_format)&&(v=_("DEFAULT_RTT")),null==(T=n.$$smap.rct_format)&&(T=_("DEFAULT_RCT")),null==(P=n.$$smap.rttn_format)&&(P=_("DEFAULT_RTTN")),null==(G=n.$$smap.s_format)&&(G=_("DEFAULT_S")),o.categories=s(u.$map(),"with_index",[1],function(k,O){var $e,ce,te;return null==k&&(k=m),null==O&&(O=m),ce=null==($e=z(k))[0]?m:$e[0],te=null==$e[1]?m:$e[1],e(_("SaiFicSkillTable"),"Category").$new(ce,te,O,G)},{$$arity:2,$$has_top_level_mlhs_arg:!0}),o.rtt=i,o.rct=d,o.rttn=x.$to_a(),o.rtt_format=v,o.rct_format=T,o.rttn_format=P},-2),S(c[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),y.$attr_reader("categories"),F(y,"$roll_command",function(u,n){var d,i=this,x=m,v=m;return H(["RTT",i.rtt]["$include?"](d=n))?i.$format_skill(i.rtt_format,i.$roll_skill(u)):H(["RCT",i.rct]["$include?"](d))?(x=i.$roll_category(u),i.$format(i.rct_format,A(["category_dice","category_name"],{category_dice:x.$dice(),category_name:x.$name()}))):H(v=_("RTTN").$index(d))||H(v=i.rttn.$index(d))?i.$format_skill(i.rttn_format,i.categories["$[]"](v).$roll(u)):m},2),F(y,"$roll_category",function(u){return this.categories["$[]"](B(u.$roll_once(6),1))},1),F(y,"$roll_skill",function(u){return this.$roll_category(u).$roll(u)},1),F(y,"$prefixes",function(){var u=this;return j(["RTT[1-6]?","RCT",u.rtt,u.rct],u.rttn).$compact()},0),y.$private(),F(y,"$format_skill",function(u,n){return this.$format(u,A(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:n.$category_dice(),row_dice:n.$row_dice(),category_name:n.$category_name(),skill_name:n.$name(),text:n.$to_s()}))},2)},Opal.modules["bcdice/dice_table/table"]=function(r){var S,B,f,a,q,L,N,V,F,M=[],t=r.nil,m=r.module,e=r.klass,p=r.hash2,E=r.defs,A=r.truthy,s=r.def,C=r.rb_minus;return S=M,B=F=[m(M[0],"BCDice")].concat(S),f=V=[m(F[0],"DiceTable")].concat(B),q=[a=e(V[0],null,"Table")].concat(f),L=r.$r(q),(N=a.$$prototype).times=N.sides=N.name=N.items=t,E(a,"$from_i18n",function(h,g){var c=t;return c=L("I18n").$t(h,p(["locale"],{locale:g})),this.$new(c["$[]"]("name"),c["$[]"]("type"),c["$[]"]("items"))},2),s(a,"$initialize",function(h,g,y){var c=this,_=t;return c.name=h,c.items=y.$freeze(),_=/(\d+)D(\d+)/i.$match(g),A(_)||c.$raise(L("ArgumentError"),"Unexpected table type: "+g),c.times=_["$[]"](1).$to_i(),c.sides=_["$[]"](2).$to_i()},3),s(a,"$roll",function(h){var y,g=this;return y=h.$roll_sum(g.times,g.sides),g.$choice(y)},1),s(a,"$choice",function(h){var y,g=this;return y=C(h,g.times),L("RollResult").$new(g.name,h,g.items["$[]"](y))},1)},Opal.modules["bcdice/dice_table"]=function(r){var M=r.top;return M.$require("bcdice/dice_table/roll_result"),M.$require("bcdice/dice_table/chain_table"),M.$require("bcdice/dice_table/d66_grid_table"),M.$require("bcdice/dice_table/d66_half_grid_table"),M.$require("bcdice/dice_table/d66_one_third_table"),M.$require("bcdice/dice_table/d66_left_range_table"),M.$require("bcdice/dice_table/d66_parity_table"),M.$require("bcdice/dice_table/d66_range_table"),M.$require("bcdice/dice_table/d66_table"),M.$require("bcdice/dice_table/range_table"),M.$require("bcdice/dice_table/sai_fic_skill_table"),M.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(r){var E,Y,z,s,M=[],m=r.module,e=r.const_set;return E=M,Y=s=[m(M[0],"BCDice")].concat(E),z=[m(s[0],"D66SortType")].concat(Y),e(z[0],"NO_SORT","no_sort"),e(z[0],"ASC","asc"),e(z[0],"DESC","desc"),function(C,Y){var z=[m(C,"RoundType")].concat(Y);return e(z[0],"CEIL","ceil"),e(z[0],"FLOOR","floor"),e(z[0],"ROUND","round")}(s[0],s)},Opal.modules["bcdice/translate"]=function(r){var s,z,F,H,B,Y,M=[],t=r.nil,m=r.module,e=r.hash2,E=r.def;return s=M,z=Y=[m(M[0],"BCDice")].concat(s),H=[F=m(Y[0],"Translate")].concat(z),B=r.$r(H),E(F,"$translate",function(V,U){var I,f=this;if(null==f.locale&&(f.locale=t),null==U)U=e([],{});else if(!U.$$is_hash)throw r.ArgumentError.$new("expected kwargs");return I=r.kwrestargs(U,{}),B("I18n").$translate(V,e(["locale","raise"],{locale:f.locale,raise:!0}).$merge(r.to_hash(I)))},-2)},Opal.modules["bcdice/result"]=function(r){var Y,B,I,j,U,z,M=[],t=r.nil,e=r.klass,p=r.send,E=r.to_a,A=r.rb_minus,s=r.def;return Y=M,B=z=[(0,r.module)(M[0],"BCDice")].concat(Y),[j=e(z[0],null,"Result")].concat(B),(U=j.$$prototype).secret=U.success=U.failure=U.critical=U.fumble=t,s(I=r.get_singleton_class(j),"$success",function(q){return p(this.$new(),"tap",[],function(b){var h=t;return null==b&&(b=t),p(b,"text=",E(h=[q])),A(h.length,1),p(b,"success=",E(h=[!0])),h[A(h.length,1)]},1)},1),s(I,"$failure",function(q){return p(this.$new(),"tap",[],function(b){var h=t;return null==b&&(b=t),p(b,"text=",E(h=[q])),A(h.length,1),p(b,"failure=",E(h=[!0])),h[A(h.length,1)]},1)},1),s(I,"$critical",function(q){return p(this.$new(),"tap",[],function(b){var h=t;return null==b&&(b=t),p(b,"text=",E(h=[q])),A(h.length,1),p(b,"critical=",E(h=[!0])),A(h.length,1),p(b,"success=",E(h=[!0])),h[A(h.length,1)]},1)},1),s(I,"$fumble",function(q){return p(this.$new(),"tap",[],function(b){var h=t;return null==b&&(b=t),p(b,"text=",E(h=[q])),A(h.length,1),p(b,"fumble=",E(h=[!0])),A(h.length,1),p(b,"failure=",E(h=[!0])),h[A(h.length,1)]},1)},1),s(I,"$nothing",function(){return"nothing"},0),s(j,"$initialize",function(f){var a=this;return null==f&&(f=t),a.text=f,a.rands=t,a.detailed_rands=t,a.secret=!1,a.success=!1,a.failure=!1,a.critical=!1,a.fumble=!1},-1),j.$attr_accessor("text","rands","detailed_rands"),j.$attr_writer("secret","success","failure","critical","fumble"),s(j,"$secret?",function(){return this.secret},0),s(j,"$success?",function(){return this.success},0),s(j,"$failure?",function(){return this.failure},0),s(j,"$critical?",function(){return this.critical},0),s(j,"$fumble?",function(){return this.fumble},0),s(j,"$condition=",function(f){return this.success=f,this.failure=f["$!"]()},1)},Opal.modules["racc/parser"]=function(r){var g,c,_,t=[],m=r.$r(t),e=r.nil,p=r.$$$,E=r.module,A=r.klass,s=r.truthy,C=r.const_set,Y=r.defs,S=r.gvars,z=r.rb_lt,F=r.send,H=r.to_a,B=r.rb_minus,j=r.def,V=r.to_ary,U=r.neqeq,I=r.rb_plus,f=r.eqeq,a=r.rb_ge,q=r.rb_gt,L=r.eqeqeq,N=r.rb_le,b=r.rb_times;return g=t,c=[E(t[0],"Racc")].concat(g),_=r.$r(c),A(c[0],_("StandardError"),"ParseError"),s(p("::","ParseError","skip_raise")?"constant":e)||C(t[0],"ParseError",p(m("Racc"),"ParseError")),function(h,g){var n,i,d,x,v,_=[E(h,"Racc")].concat(g),l=r.$r(_);return s(l("Racc_No_Extensions","skip_raise")?"constant":e)||C(_[0],"Racc_No_Extensions",!1),n=_,d=[i=A(_[0],null,"Parser")].concat(n),x=r.$r(d),(v=i.$$prototype).yydebug=v.racc_debug_out=v.racc_error_status=v.racc_t=v.racc_vstack=v.racc_val=v.racc_state=v.racc_tstack=e,C(d[0],"Racc_Runtime_Version","1.4.6"),C(d[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),C(d[0],"Racc_Runtime_Core_Version_R","1.4.6"),C(d[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),C(d[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),C(d[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),C(d[0],"Racc_Runtime_Core_Version",x("Racc_Runtime_Core_Version_R")),C(d[0],"Racc_Runtime_Core_Revision",x("Racc_Runtime_Core_Revision_R")),C(d[0],"Racc_Runtime_Type","ruby"),Y(x("Parser"),"$racc_runtime_type",function(){return x("Racc_Runtime_Type")},0),j(i,"$_racc_setup",function(){var P,G,o=this,Z=e,k=e,O=e;return null==S.stderr&&(S.stderr=e),s(p(o.$class(),"Racc_debug_parser"))||(o.yydebug=!1),s(null!=(P=o.yydebug)&&P!==e?"instance-variable":e)||(o.yydebug=!1),s(o.yydebug)&&(s(null!=(G=o.racc_debug_out)&&G!==e?"instance-variable":e)||(o.racc_debug_out=S.stderr),o.racc_debug_out=s(Z=o.racc_debug_out)?Z:S.stderr),k=p(o.$class(),"Racc_arg"),s(z(k.$size(),14))&&(F(k,"[]=",H(O=[13,!0])),B(O.length,1)),k},0),j(i,"$_racc_init_sysvars",function(){var P=this;return P.racc_state=[0],P.racc_tstack=[],P.racc_vstack=[],P.racc_t=e,P.racc_val=e,P.racc_read_next=!0,P.racc_user_yyerror=!1,P.racc_error_status=0},0),j(i,"$do_parse",function(){return this.$__send__(x("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)},0),j(i,"$next_token",function(){return this.$raise(x("NotImplementedError"),this.$class()+"#next_token is not defined")},0),j(i,"$_racc_do_parse_rb",function(P,G){var o,k=this,O=e,$e=e,ne=e,ce=e,K=e,D=e,Q=e,R=e;return o=V(P),O=null==o[0]?e:o[0],$e=null==o[1]?e:o[1],ne=null==o[2]?e:o[2],ce=null==o[3]?e:o[3],K=null==o[10]?e:o[10],k.$_racc_init_sysvars(),D=Q=R=e,F(k,"catch",["racc_end_parse"],function w(){var re,X,W=null==w.$$s?this:w.$$s,ae=e;for(null==W.racc_state&&(W.racc_state=e),null==W.racc_read_next&&(W.racc_read_next=e),null==W.racc_t&&(W.racc_t=e),null==W.yydebug&&(W.yydebug=e),null==W.racc_val&&(W.racc_val=e);s(!0);)for(s(R=ce["$[]"](W.racc_state["$[]"](-1)))?(s(W.racc_read_next)&&U(W.racc_t,0)&&(X=W.$next_token(),re=V(X),D=null==re[0]?e:re[0],W.racc_val=null==re[1]?e:re[1],W.racc_t=s(D)?s(ae=K["$[]"](D))?ae:1:0,s(W.yydebug)&&W.$racc_read_token(W.racc_t,D,W.racc_val),W.racc_read_next=!1),R=I(R,W.racc_t),s(a(R,0))&&s(Q=O["$[]"](R))&&f($e["$[]"](R),W.racc_state["$[]"](-1))||(Q=ne["$[]"](W.racc_state["$[]"](-1)))):Q=ne["$[]"](W.racc_state["$[]"](-1));s(Q=W.$_racc_evalact(Q,P)););},{$$arity:0,$$s:k})},2),j(i,"$yyparse",function(P,G){return this.$__send__(x("Racc_YY_Parse_Method"),P,G,this.$_racc_setup(),!0)},2),j(i,"$_racc_yyparse_rb",function(P,G,o,Z){var k,ne=e,ce=e,te=e,K=e,Q=e,R=e,w=e;return k=V(o),ne=null==k[0]?e:k[0],ce=null==k[1]?e:k[1],te=null==k[2]?e:k[2],K=null==k[3]?e:k[3],Q=null==k[10]?e:k[10],this.$_racc_init_sysvars(),R=e,w=e,F(this,"catch",["racc_end_parse"],function ee(){var W=null==ee.$$s?this:ee.$$s;for(null==W.racc_state&&(W.racc_state=e);!s(w=K["$[]"](W.racc_state["$[]"](-1)));)for(;s(R=W.$_racc_evalact(te["$[]"](W.racc_state["$[]"](-1)),o)););return F(P,"__send__",[G],function ae(se,_e){var ie=null==ae.$$s?this:ae.$$s,J=e,oe=e;for(null==ie.racc_t&&(ie.racc_t=e),null==ie.racc_state&&(ie.racc_state=e),null==ie.racc_read_next&&(ie.racc_read_next=e),null==se&&(se=e),null==_e&&(_e=e),ie.racc_t=s(se)?s(J=Q["$[]"](se))?J:1:0,ie.racc_val=_e,ie.racc_read_next=!1,w=I(w,ie.racc_t),s(a(w,0))&&s(R=ne["$[]"](w))&&f(ce["$[]"](w),ie.racc_state["$[]"](-1))||(R=te["$[]"](ie.racc_state["$[]"](-1)));s(R=ie.$_racc_evalact(R,o)););for(;s(s(J=s(oe=(w=K["$[]"](ie.racc_state["$[]"](-1)))["$!"]())?oe:ie.racc_read_next["$!"]())?J:ie.racc_t["$=="](0));)for(s(w)&&s(w=I(w,ie.racc_t))&&s(a(w,0))&&s(R=ne["$[]"](w))&&f(ce["$[]"](w),ie.racc_state["$[]"](-1))||(R=te["$[]"](ie.racc_state["$[]"](-1)));s(R=ie.$_racc_evalact(R,o)););},{$$arity:2,$$s:W})},{$$arity:0,$$s:this})},4),j(i,"$_racc_evalact",function(P,G){var o,te,k=this,O=e,$e=e,ce=e,K=e,D=e,Q=e,R=e;if(O=null==(o=V(G))[0]?e:o[0],$e=null==o[1]?e:o[1],ce=null==o[3]?e:o[3],te=null==o[11]?e:o[11],K=null==o[12]?e:o[12],s(q(P,0))&&s(z(P,te)))s(q(k.racc_error_status,0))&&(f(k.racc_t,1)||(k.racc_error_status=B(k.racc_error_status,1))),k.racc_vstack.$push(k.racc_val),k.racc_state.$push(P),k.racc_read_next=!0,s(k.yydebug)&&(k.racc_tstack.$push(k.racc_t),k.$racc_shift(k.racc_t,k.racc_tstack,k.racc_vstack));else if(s(z(P,0))&&s(q(P,K["$-@"]()))){if(D=F(k,"catch",["racc_jump"],function w(){var ee=null==w.$$s?this:w.$$s;return null==ee.racc_state&&(ee.racc_state=e),ee.racc_state.$push(ee.$_racc_do_reduce(G,P)),!1},{$$arity:0,$$s:k}),s(D)){if(L(1,Q=D))return k.racc_user_yyerror=!0,K["$-@"]();if(L(2,Q))return te;k.$raise("[Racc Bug] unknown jump code")}}else if(f(P,te))s(k.yydebug)&&k.$racc_accept(),k.$throw("racc_end_parse",k.racc_vstack["$[]"](0));else{if(f(P,K["$-@"]())){for(L(0,Q=k.racc_error_status)?s(G["$[]"](21))||k.$on_error(k.racc_t,k.racc_val,k.racc_vstack):L(3,Q)&&(f(k.racc_t,0)&&k.$throw("racc_end_parse",e),k.racc_read_next=!0),k.racc_user_yyerror=!1,k.racc_error_status=3;s(!0)&&!(s(R=ce["$[]"](k.racc_state["$[]"](-1)))&&(R=I(R,1),s(a(R,0))&&s(P=O["$[]"](R))&&f($e["$[]"](R),k.racc_state["$[]"](-1))));)s(N(k.racc_state.$size(),1))&&k.$throw("racc_end_parse",e),k.racc_state.$pop(),k.racc_vstack.$pop(),s(k.yydebug)&&(k.racc_tstack.$pop(),k.$racc_e_pop(k.racc_state,k.racc_tstack,k.racc_vstack));return P}k.$raise("[Racc Bug] unknown action "+P.$inspect())}return s(k.yydebug)&&k.$racc_next_state(k.racc_state["$[]"](-1),k.racc_state),e},2),j(i,"$_racc_do_reduce",function(P,G){var o,K,Q,W,ae,se,ie,k=this,$e=e,ne=e,ce=e,te=e,D=e,R=e,w=e,ee=e,re=e,X=e,_e=e,le=e,ue=e,J=e;return $e=null==(o=V(P))[4]?e:o[4],ne=null==o[5]?e:o[5],ce=null==o[6]?e:o[6],te=null==o[7]?e:o[7],K=null==o[8]?e:o[8],D=null==o[9]?e:o[9],Q=null==o[13]?e:o[13],R=k.racc_state,w=k.racc_vstack,ee=k.racc_tstack,re=b(G,-3),X=D["$[]"](re),W=D["$[]"](I(re,1)),ae=D["$[]"](I(re,2)),se=[],s(k.yydebug)&&(_e=ee["$[]"](X["$-@"](),X)),le=w["$[]"](X["$-@"](),X),s(k.yydebug)&&(ue=[X["$-@"](),X,se],F(ee,"[]=",H(ue)),B(ue.length,1)),ue=[X["$-@"](),X,se],F(w,"[]=",H(ue)),B(ue.length,1),ue=[X["$-@"](),X,se],F(R,"[]=",H(ue)),B(ue.length,1),s(Q)?w.$push(k.$__send__(ae,le,w,le["$[]"](0))):w.$push(k.$__send__(ae,le,w)),ee.$push(W),s(k.yydebug)&&k.$racc_reduce(_e,W,ee,w),ie=B(W,K),s(re=te["$[]"](ie))&&(re=I(re,R["$[]"](-1)),s(a(re,0))&&s(J=$e["$[]"](re))&&f(ne["$[]"](re),ie))?J:ce["$[]"](ie)},2),j(i,"$on_error",function(P,G,o){var k,Z=this;return Z.$raise(x("ParseError"),Z.$sprintf("\nparse error on value %s (%s)",G.$inspect(),s(k=Z.$token_to_str(P))?k:"?"))},3),j(i,"$yyerror",function(){return this.$throw("racc_jump",1)},0),j(i,"$yyaccept",function(){return this.$throw("racc_jump",2)},0),j(i,"$yyerrok",function(){return this.racc_error_status=0},0),j(i,"$racc_read_token",function(P,G,o){var Z=this;return Z.racc_debug_out.$print("read    "),Z.racc_debug_out.$print(G.$inspect(),"(",Z.$racc_token2str(P),") "),Z.racc_debug_out.$puts(o.$inspect()),Z.racc_debug_out.$puts()},3),j(i,"$racc_shift",function(P,G,o){var Z=this;return Z.racc_debug_out.$puts("shift   "+Z.$racc_token2str(P)),Z.$racc_print_stacks(G,o),Z.racc_debug_out.$puts()},3),j(i,"$racc_reduce",function(P,G,o,Z){var k=this,O=e;return(O=k.racc_debug_out).$print("reduce "),s(P["$empty?"]())?O.$print(" <none>"):F(P,"each",[],function $e(ne){return null==ne&&(ne=e),O.$print(" ",(null==$e.$$s?this:$e.$$s).$racc_token2str(ne))},{$$arity:1,$$s:k}),O.$puts(" --\x3e "+k.$racc_token2str(G)),k.$racc_print_stacks(o,Z),k.racc_debug_out.$puts()},4),j(i,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()},0),j(i,"$racc_e_pop",function(P,G,o){var Z=this;return Z.racc_debug_out.$puts("error recovering mode: pop token"),Z.$racc_print_states(P),Z.$racc_print_stacks(G,o),Z.racc_debug_out.$puts()},3),j(i,"$racc_next_state",function(P,G){var o=this;return o.racc_debug_out.$puts("goto    "+P),o.$racc_print_states(G),o.racc_debug_out.$puts()},2),j(i,"$racc_print_stacks",function(P,G){var Z=e;return(Z=this.racc_debug_out).$print("        ["),F(P,"each_index",[],function k(O){return null==O&&(O=e),Z.$print(" (",(null==k.$$s?this:k.$$s).$racc_token2str(P["$[]"](O))," ",G["$[]"](O).$inspect(),")")},{$$arity:1,$$s:this}),Z.$puts(" ]")},2),j(i,"$racc_print_states",function(P){var o=e;return(o=this.racc_debug_out).$print("        ["),F(P,"each",[],function(k){return null==k&&(k=e),o.$print(" ",k)},1),o.$puts(" ]")},1),j(i,"$racc_token2str",function(P){var o;return s(o=p(this.$class(),"Racc_token_to_s_table")["$[]"](P))?o:this.$raise("[Racc Bug] can't convert token "+P+" to string")},1),j(i,"$token_to_str",function(P){return p(this.$class(),"Racc_token_to_s_table")["$[]"](P)},1)}(t[0],t)},Opal.modules["bcdice/arithmetic/node"]=function(r){var B,I,L,c,_,b,h,a,V,M=[],t=r.nil,m=r.$$$,e=r.module,p=r.klass,E=r.def,A=r.send2,s=r.find_super,C=r.eqeq,Y=r.const_set,S=r.eqeqeq,z=r.rb_divide,F=r.alias;return B=M,I=V=[e(M[0],"BCDice")].concat(B),L=a=[e(V[0],"Arithmetic")].concat(I),b=[e(a[0],"Node")].concat(L),h=r.$r(b),(_=(c=p(b[0],null,"BinaryOp")).$$prototype).lhs=_.rhs=_.op=t,E(c,"$initialize",function($,u,n){var i=this;return i.lhs=$,i.op=u,i.rhs=n},3),E(c,"$eval",function($){var i,u=this,n=t;return n=u.lhs.$eval($),i=u.rhs.$eval($),n.$send(u.op,i)},1),E(c,"$output",function(){var $=this;return""+$.lhs.$output()+$.op+$.rhs.$output()},0),E(c,"$s_exp",function(){var $=this;return"("+$.$op_for_s_exp()+" "+$.lhs.$s_exp()+" "+$.rhs.$s_exp()+")"},0),E(c,"$op_for_s_exp",function(){return this.op},0),function(g,y,c){var _=p(g,y,"DivideBase"),l=[_].concat(c),$=r.$r(l),u=_.$$prototype;u.lhs=u.rhs=u.op=t,E(_,"$initialize",function n(i,d){return delete n.$$p,A(this,s(this,"initialize",n,!1,!0),"initialize",[i,"/",d],null)},2),E(_,"$eval",function(i){var x,v,d=this;return x=d.lhs.$eval(i),v=d.rhs.$eval(i),C(v,0)&&d.$raise($("ZeroDivisionError")),d.$divide_and_round(x,v,i)},1),E(_,"$output",function n(){var i=n.$$p||t,d=this;return delete n.$$p,""+A(d,s(d,"output",n,!1,!0),"output",[],i)+d.$rounding_method()},0),_.$private(),E(_,"$rounding_method",function(){return m(this.$class(),"ROUNDING_METHOD")},0),E(_,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()},0),E(_,"$divide_and_round",function(i,d,x){return this.$raise($("NotImplementedError"))},3)}(b[0],h("BinaryOp"),b),function(g,y,c){var _=p(g,y,"DivideWithGameSystemDefault"),l=[_].concat(c),$=r.$r(l);Y(l[0],"ROUNDING_METHOD",""),_.$private(),E(_,"$divide_and_round",function(n,i,d){var x;return S(m($("RoundType"),"CEIL"),x=d)?z(n.$to_f(),i).$ceil():S(m($("RoundType"),"ROUND"),x)?z(n.$to_f(),i).$round():z(n,i).$floor()},3)}(b[0],h("DivideBase"),b),function(g,y,c){var _=p(g,y,"DivideWithCeil"),l=[_].concat(c);Y(l[0],"ROUNDING_METHOD","C"),_.$private(),E(_,"$divide_and_round",function(u,n,i){return z(u.$to_f(),n).$ceil()},3)}(b[0],h("DivideBase"),b),function(g,y,c){var _=p(g,y,"DivideWithRound"),l=[_].concat(c);Y(l[0],"ROUNDING_METHOD","R"),_.$private(),E(_,"$divide_and_round",function(u,n,i){return z(u.$to_f(),n).$round()},3)}(b[0],h("DivideBase"),b),function(g,y,c){var _=p(g,y,"DivideWithFloor"),l=[_].concat(c);Y(l[0],"ROUNDING_METHOD","F"),_.$private(),E(_,"$divide_and_round",function(u,n,i){return z(u,n).$to_i()},3)}(b[0],h("DivideBase"),b),function(g,y){var c=p(g,null,"Negative");c.$$prototype.body=t,E(c,"$initialize",function($){return this.body=$},1),E(c,"$eval",function($){return this.body.$eval($)["$-@"]()},1),E(c,"$output",function(){return"-"+this.body.$output()},0),E(c,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"},0)}(b[0]),function(g,y){var c=p(g,null,"Parenthesis");c.$$prototype.expr=t,E(c,"$initialize",function($){return this.expr=$},1),E(c,"$eval",function($){return this.expr.$eval($)},1),E(c,"$output",function(){return"("+this.expr.$output()+")"},0),E(c,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"},0)}(b[0]),function(g,y){var c=p(g,null,"Number");return c.$$prototype.value=t,E(c,"$initialize",function($){return this.value=$},1),E(c,"$eval",function($){return this.value},1),E(c,"$output",function(){return this.value.$to_s()},0),F(c,"s_exp","output")}(b[0])},Opal.modules.strscan=function(r){var H,B,j,V,U,M=[],t=r.nil,e=r.def,p=r.truthy,E=r.eqeqeq,A=r.Opal,s=r.send,C=r.to_a,Y=r.rb_minus,S=r.alias;return H=M,j=[B=(0,r.klass)(M[0],null,"StringScanner")].concat(H),V=r.$r(j),(U=B.$$prototype).pos=U.string=U.working=U.matched=U.prev_pos=U.match=t,B.$attr_reader("pos","matched"),e(B,"$initialize",function(f){var a=this;return a.string=f,a.pos=0,a.matched=t,a.working=f,a.match=[]},1),B.$attr_reader("string"),e(B,"$beginning_of_line?",function(){var f=this;return 0===f.pos||"\n"===f.string.charAt(f.pos-1)},0),e(B,"$scan",function(f){var a=this,q=(f=a.$anchor(f)).exec(a.working);return null==q?a.matched=t:"object"==typeof q?(a.prev_pos=a.pos,a.pos+=q[0].length,a.working=a.working.substring(q[0].length),a.matched=q[0],a.match=q,q[0]):"string"==typeof q?(a.pos+=q.length,a.working=a.working.substring(q.length),q):t},1),e(B,"$scan_until",function(f){var a=this;f=a.$anchor(f);for(var N,q=a.pos,L=a.working;;){if(N=f.exec(L),q+=1,L=L.substr(1),null!=N)return a.matched=a.string.substr(a.pos,q-a.pos-1+N[0].length),a.match=N,a.prev_pos=q-1,a.pos=q,a.working=L.substr(N[0].length),a.matched;if(0===L.length)return a.match=[],a.matched=t}},1),e(B,"$[]",function(f){var q;if(p(this.match["$empty?"]()))return t;E(V("Symbol"),q=f)?f=f.$to_s():E(V("String"),q)||(f=A["$coerce_to!"](f,V("Integer"),"to_int"));var L=this.match;return f<0&&(f+=L.length),f<0||f>=L.length||null==L[f]?t:L[f]},1),e(B,"$check",function(f){var a=this,q=(f=a.$anchor(f)).exec(a.working);return a.matched=null==q?t:q[0]},1),e(B,"$check_until",function(f){var a=this,q=a.prev_pos,L=a.pos,N=a.$scan_until(f);return N!==t&&(a.matched=N.substr(-1),a.working=a.string.substr(L)),a.prev_pos=q,a.pos=L,N},1),e(B,"$peek",function(f){return this.working.substring(0,f)},1),e(B,"$eos?",function(){return 0===this.working.length},0),e(B,"$exist?",function(f){var q=f.exec(this.working);return null==q?t:0==q.index?0:q.index+1},1),e(B,"$skip",function(f){var a=this,q=(f=a.$anchor(f)).exec(a.working);if(null==q)return a.match=[],a.matched=t;var L=q[0],N=L.length;return a.matched=L,a.match=q,a.prev_pos=a.pos,a.pos+=N,a.working=a.working.substring(N),N},1),e(B,"$skip_until",function(f){var q=this.$scan_until(f);return q===t?t:(this.matched=q.substr(-1),q.length)},1),e(B,"$get_byte",function(){var f=this,a=t;return f.pos<f.string.length?(f.prev_pos=f.pos,f.pos+=1,a=f.matched=f.working.substring(0,1),f.working=f.working.substring(1)):f.matched=t,a},0),e(B,"$match?",function(f){var a=this,q=(f=a.$anchor(f)).exec(a.working);return null==q?t:(a.prev_pos=a.pos,q[0].length)},1),e(B,"$pos=",function(f){var a=this;return f<0&&(f+=a.string.$length()),a.pos=f,a.working=a.string.slice(f)},1),e(B,"$matched_size",function(){return this.matched===t?t:this.matched.length},0),e(B,"$post_match",function(){var f=this;return f.matched===t?t:f.string.substr(f.pos)},0),e(B,"$pre_match",function(){var f=this;return f.matched===t?t:f.string.substr(0,f.prev_pos)},0),e(B,"$reset",function(){var f=this;return f.working=f.string,f.matched=t,f.pos=0},0),e(B,"$rest",function(){return this.working},0),e(B,"$rest?",function(){return 0!==this.working.length},0),e(B,"$rest_size",function(){return this.$rest().$size()},0),e(B,"$terminate",function(){var a,f=this;return f.match=t,a=[f.string.$length()],s(f,"pos=",C(a)),a[Y(a.length,1)]},0),e(B,"$unscan",function(){var f=this;return f.pos=f.prev_pos,f.prev_pos=t,f.match=t,f},0),S(B,"bol?","beginning_of_line?"),S(B,"getch","get_byte"),B.$private(),e(B,"$anchor",function(f){var a=f.toString().match(/\/([^\/]+)$/);return a=a?a[1]:void 0,new RegExp("^(?:"+f.source+")",a)},1)},Opal.modules["bcdice/normalize"]=function(r){var s,z,Y,M=[],t=r.nil,m=r.module,e=r.eqeqeq,p=r.def,E=r.eqeq;return s=M,Y=[m(M[0],"BCDice")].concat(s),(z=m(Y[0],"Normalize")).$module_function(),p(z,"$comparison_operator",function(H){var B;return e(/<=|=</,B=H)?"<=":e(/>=|=>/,B)?">=":e(/<>|!=|=!/,B)?"!=":e(/</,B)?"<":e(/>/,B)?">":e(/=/,B)?"==":t},1),p(z,"$target_number",function(H){return E(H,"?")?H:H.$to_i()},1)},Opal.modules["bcdice/command/lexer"]=function(r){var z,j,a,q,L,N,b,U,H,M=r.top,t=[],m=r.nil,e=r.module,p=r.klass,E=r.const_set,A=r.hash2,s=r.truthy,C=r.send,Y=r.def;return M.$require("strscan"),M.$require("bcdice/normalize"),z=t,j=H=[e(t[0],"BCDice")].concat(z),a=U=[e(H[0],"Command")].concat(j),L=[q=p(U[0],null,"Lexer")].concat(a),N=r.$r(L),(b=q.$$prototype).scanner=b.notations=m,E(L[0],"SYMBOLS",A(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),Y(q,"$initialize",function(g,y){var c,_,$;return g=s($=(_=(c=g)===m||null==c?m:C(c,"split",[" ",2]))===m||null==_?m:C(_,"first",[]))?$:"",this.scanner=N("StringScanner").$new(g),this.notations=C(y,"map",[],function(n){return null==n&&(n=m),s(n["$is_a?"](N("String")))?N("Regexp").$new(n):n},1)},2),Y(q,"$next_token",function(){try{var g=this,y=m,c=m,l=m,$=m;return s(g.scanner["$eos?"]())?[!1,"$"]:(C(g.notations,"each",[],function u(n){var d,i=null==u.$$s?this:u.$$s;if(null==i.scanner&&(i.scanner=m),null==n&&(n=m),d=i.scanner.$scan(n),!s(d))return m;r.ret(["NOTATION",d])},{$$arity:1,$$s:g}),s(y=g.scanner.$scan(/\d+/))?["NUMBER",y.$to_i()]:s(c=g.scanner.$scan(/[<>!=]+/))?(c=N("Normalize").$comparison_operator(c),[s(c)?"CMP_OP":"ILLEGAL",c]):(l=g.scanner.$getch().$upcase(),[s($=N("SYMBOLS")["$[]"](l))?$:l.$to_sym(),l]))}catch(u){if(u===r.returner)return u.$v;throw u}},0),Y(q,"$source",function(){return this.scanner.$string()},0)},Opal.modules["bcdice/command/parsed"]=function(r){var C,F,U,I,f,a,q,B,S,M=[],t=r.nil,m=r.module,e=r.klass,p=r.def,E=r.truthy,A=r.eqeqeq;return C=M,F=S=[m(M[0],"BCDice")].concat(C),U=B=[m(S[0],"Command")].concat(F),f=[I=e(B[0],null,"Parsed")].concat(U),a=r.$r(f),(q=I.$$prototype).question_target=q.critical=q.fumble=q.dollar=q.modify_number=q.target_number=q.prefix_number=q.command=q.suffix_number=q.cmp_op=t,I.$attr_accessor("command"),I.$attr_accessor("prefix_number"),I.$attr_accessor("suffix_number"),I.$attr_accessor("critical"),I.$attr_accessor("fumble"),I.$attr_accessor("dollar"),I.$attr_accessor("modify_number"),I.$attr_accessor("cmp_op"),I.$attr_accessor("target_number"),I.$attr_writer("question_target"),p(I,"$initialize",function(){var N=this;return N.prefix_number=t,N.suffix_number=t,N.critical=t,N.fumble=t,N.dollar=t,N.cmp_op=t,N.target_number=t,N.question_target=!1},0),p(I,"$question_target?",function(){return this.question_target},0),p(I,"$to_s",function(N){var l,b=this,h=t,g=t,y=t,c=t,_=t;return null==N&&(N="after_command"),h=E(b.critical)?"@"+b.critical:t,g=E(b.fumble)?"#"+b.fumble:t,y=E(b.dollar)?"$"+b.dollar:t,c=a("Format").$modifier(b.modify_number),_=E(b.question_target)?"?":b.target_number,A("after_command",l=N)?[b.prefix_number,b.command,b.suffix_number,h,g,y,c,b.cmp_op,_].$join():A("after_modify_number",l)?[b.prefix_number,b.command,b.suffix_number,c,h,g,y,b.cmp_op,_].$join():A("after_target_number",l)?[b.prefix_number,b.command,b.suffix_number,c,b.cmp_op,_,h,g,y].$join():t},-1)},Opal.modules["bcdice/command/parser"]=function(r){var a,b,l,i,d,x,v,T,P,G,o,Z,$e,$,u,n,te,g,y,L,M=r.top,t=[],m=r.$r(t),e=r.nil,p=r.$$$,E=r.klass,A=r.module,s=r.hash2,C=r.send2,Y=r.find_super,S=r.def,z=r.send,F=r.to_a,H=r.rb_minus,B=r.eqeq,j=r.hash,V=r.const_set,U=r.truthy,I=r.to_ary;return M.$require("racc/parser.rb"),M.$require("bcdice/arithmetic/node"),M.$require("bcdice/command/lexer"),M.$require("bcdice/command/parsed"),E(p(m("BCDice"),"Command"),p(m("Racc"),"Parser"),"Parser"),a=t,b=L=[A(t[0],"BCDice")].concat(a),g=[A(L[0],"Command")].concat(b),y=r.$r(g),l=g,u=[$=E(g[0],p(y("Racc"),"Parser"),"Parser")].concat(l),n=r.$r(u),(te=$.$$prototype).notations=te.lexer=te.modifier=te.suffix_number=te.prefix_number=te.need_suffix_number=te.need_prefix_number=te.critical=te.fumble=te.dollar=te.allowed_cmp_op=te.question_target=e,S($,"$initialize",function K(D,Q){var R,w,ee,re,W=this;if(delete K.$$p,R=r.slice.call(arguments),null==(w=r.extract_kwargs(R)))w=s([],{});else if(!w.$$is_hash)throw r.ArgumentError.$new("expected kwargs");if(ee=R,!r.hasOwnProperty.call(w.$$smap,"round_type"))throw r.ArgumentError.$new("missing keyword: round_type");return re=w.$$smap.round_type,C(W,Y(W,"initialize",K,!1,!0),"initialize",[],null),W.notations=ee,W.round_type=re,W.prefix_number=!1,W.suffix_number=!1,W.need_prefix_number=!1,W.need_suffix_number=!1,W.modifier=!0,W.critical=!1,W.fumble=!1,W.dollar=!1,W.allowed_cmp_op=[e,">=",">","<=","<","==","!="],W.question_target=!1},-2),S($,"$disable_modifier",function(){return this.modifier=!1,this},0),S($,"$enable_prefix_number",function(){return this.prefix_number=!0,this},0),S($,"$enable_suffix_number",function(){return this.suffix_number=!0,this},0),S($,"$has_prefix_number",function(){var D=this;return D.prefix_number=!0,D.need_prefix_number=!0,D},0),S($,"$has_suffix_number",function(){var D=this;return D.suffix_number=!0,D.need_suffix_number=!0,D},0),S($,"$enable_critical",function(){return this.critical=!0,this},0),S($,"$enable_fumble",function(){return this.fumble=!0,this},0),S($,"$enable_dollar",function(){return this.dollar=!0,this},0),S($,"$restrict_cmp_op_to",function(D){var Q,w=this;return Q=r.slice.call(arguments),w.allowed_cmp_op=Q,w},-1),S($,"$enable_question_target",function(){return this.question_target=!0,this},0),S($,"$parse",function(D){var Q=this;try{return Q.lexer=n("Lexer").$new(D,Q.notations),Q.$do_parse()}catch(R){if(!r.rescue(R,[n("ParseError"),n("ZeroDivisionError")]))throw R;try{return e}finally{r.pop_exception()}}},1),$.$private(),S($,"$parsed",function(D,Q,R,w){return z(n("Parsed").$new(),"tap",[],function re(X){var W,ae,se,_e,le,ue,ie=null==re.$$s?this:re.$$s,J=e;return null==ie.round_type&&(ie.round_type=e),null==X&&(X=e),J=[D["$[]"]("command")],z(X,"command=",F(J)),H(J.length,1),J=[(W=D["$[]"]("prefix"),W===e||null==W?e:z(W,"eval",[ie.round_type]))],z(X,"prefix_number=",F(J)),H(J.length,1),J=[(ae=D["$[]"]("suffix"),ae===e||null==ae?e:z(ae,"eval",[ie.round_type]))],z(X,"suffix_number=",F(J)),H(J.length,1),J=[(se=Q["$[]"]("critical"),se===e||null==se?e:z(se,"eval",[ie.round_type]))],z(X,"critical=",F(J)),H(J.length,1),J=[(_e=Q["$[]"]("fumble"),_e===e||null==_e?e:z(_e,"eval",[ie.round_type]))],z(X,"fumble=",F(J)),H(J.length,1),J=[(le=Q["$[]"]("dollar"),le===e||null==le?e:z(le,"eval",[ie.round_type]))],z(X,"dollar=",F(J)),H(J.length,1),J=[R.$eval(ie.round_type)],z(X,"modify_number=",F(J)),H(J.length,1),J=[w["$[]"]("cmp_op")],z(X,"cmp_op=",F(J)),H(J.length,1),B(w["$[]"]("target"),"?")?(z(X,"question_target=",F(J=[!0])),H(J.length,1),z(X,"target_number=",F(J=[0])),J[H(J.length,1)]):(z(X,"question_target=",F(J=[!1])),H(J.length,1),J=[(ue=w["$[]"]("target"),ue===e||null==ue?e:z(ue,"eval",[ie.round_type]))],z(X,"target_number=",F(J)),J[H(J.length,1)])},{$$arity:1,$$s:this})},4),S($,"$next_token",function(){return this.lexer.$next_token()},0),i=[6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,e,5,36,37,17,18,6,e,5,36,37,17,18,6,e,5,36,37,17,18,6,e,5,33,34,17,18,6,e,5,36,37,17,18,6,e,5,36,37,17,18,6,e,5,36,37,17,18,6,e,5,36,37,17,18,6,e,5,e,e,17,18,6,e,5,e,e,17,18,e,e,5,23,24,25,26,56,54,55,57],d=[0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,e,17,15,15,18,18,23,e,18,30,30,23,23,24,e,23,31,31,24,24,25,e,24,44,44,25,25,28,e,25,47,47,28,28,29,e,28,48,48,29,29,33,e,29,49,49,33,33,34,e,33,50,50,34,34,36,e,34,e,e,36,36,37,e,36,e,e,37,37,e,e,37,27,27,27,27,52,52,52,52],x=[-2,4,16,-3,-1,11,e,33,13,35,23,30,1,e,28,40,e,37,44,e,e,-2,e,51,58,65,0,106,72,79,47,54,e,86,93,e,100,107,e,e,e,e,e,e,63,e,e,68,75,82,89,e,120,e,e,e,e,e],v=[-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29],T=[30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,e,e,21,47,48,40,51,52,49,50,44,46,3,e,e,e,13,e,e,e,e,e,e,e,32],P=[8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,e,e,4,8,8,5,7,7,8,8,9,5,6,e,e,e,6,e,e,e,e,e,e,e,6],G=[e,6,13,3,9,-1,27,-15,-10,-1,-38],o=[e,e,e,e,e,e,19,16,15,e,e],Z=[0,0,"racc_error",4,20,"_reduce_1",4,20,"_reduce_2",3,20,"_reduce_3",3,21,"_reduce_4",2,21,"_reduce_5",2,21,"_reduce_6",1,21,"_reduce_7",0,22,"_reduce_8",3,22,"_reduce_9",3,22,"_reduce_10",3,22,"_reduce_11",2,23,"_reduce_12",2,23,"_reduce_13",3,23,"_reduce_14",3,23,"_reduce_15",0,24,"_reduce_16",2,24,"_reduce_17",2,24,"_reduce_18",3,28,"_reduce_19",3,28,"_reduce_20",1,28,"_reduce_none",3,27,"_reduce_22",4,27,"_reduce_23",1,27,"_reduce_none",0,29,"_reduce_25",1,29,"_reduce_26",1,29,"_reduce_27",1,29,"_reduce_28",1,29,"_reduce_29",2,26,"_reduce_30",2,26,"_reduce_31",1,26,"_reduce_none",3,25,"_reduce_33",1,25,"_reduce_34"],$e=j(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),V(u[0],"Racc_arg",[i,d,v,x,T,P,o,G,19,Z,$e,58,35,!0]),V(u[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),V(u[0],"Racc_debug_parser",!1),S($,"$_reduce_1",function(D,Q,R){var w;return U(this.modifier)||this.$raise(n("ParseError")),w=I(D),this.$parsed(null==w[0]?e:w[0],null==w[1]?e:w[1],null==w[2]?e:w[2],null==w[3]?e:w[3])},3),S($,"$_reduce_2",function(D,Q,R){var w;return U(this.modifier)||this.$raise(n("ParseError")),w=I(D),this.$parsed(null==w[0]?e:w[0],null==w[2]?e:w[2],null==w[1]?e:w[1],null==w[3]?e:w[3])},3),S($,"$_reduce_3",function(D,Q,R){var w,ae;return ae=null==(w=I(D))[2]?e:w[2],this.$parsed(null==w[0]?e:w[0],null==w[1]?e:w[1],p(p(n("Arithmetic"),"Node"),"Number").$new(0),ae)},3),S($,"$_reduce_4",function(D,Q,R){var w=this;return U(w.prefix_number)&&U(w.suffix_number)||w.$raise(n("ParseError")),s(["command","prefix","suffix"],{command:D["$[]"](1),prefix:D["$[]"](0),suffix:D["$[]"](2)})},3),S($,"$_reduce_5",function(D,Q,R){var w=this;return U(w.prefix_number)||w.$raise(n("ParseError")),U(w.need_suffix_number)&&w.$raise(n("ParseError")),s(["command","prefix"],{command:D["$[]"](1),prefix:D["$[]"](0)})},3),S($,"$_reduce_6",function(D,Q,R){var w=this;return U(w.suffix_number)||w.$raise(n("ParseError")),U(w.need_prefix_number)&&w.$raise(n("ParseError")),s(["command","suffix"],{command:D["$[]"](0),suffix:D["$[]"](1)})},3),S($,"$_reduce_7",function(D,Q,R){var w=this;return(U(w.need_prefix_number)||U(w.need_suffix_number))&&w.$raise(n("ParseError")),s(["command"],{command:D["$[]"](0)})},3),S($,"$_reduce_8",function(D,Q,R){return s([],{})},3),S($,"$_reduce_9",function(D,Q,R){var w,ae,se,X=e;return X=null==(w=I(D))[0]?e:w[0],ae=null==w[2]?e:w[2],U(this.critical)&&U(X["$[]"]("critical")["$nil?"]())||this.$raise(n("ParseError")),z(X,"[]=",F(se=["critical",ae])),H(se.length,1),X},3),S($,"$_reduce_10",function(D,Q,R){var w,ae,se,X=e;return X=null==(w=I(D))[0]?e:w[0],ae=null==w[2]?e:w[2],U(this.fumble)&&U(X["$[]"]("fumble")["$nil?"]())||this.$raise(n("ParseError")),z(X,"[]=",F(se=["fumble",ae])),H(se.length,1),X},3),S($,"$_reduce_11",function(D,Q,R){var w,ae,se,X=e;return X=null==(w=I(D))[0]?e:w[0],ae=null==w[2]?e:w[2],U(this.dollar)&&U(X["$[]"]("dollar")["$nil?"]())||this.$raise(n("ParseError")),z(X,"[]=",F(se=["dollar",ae])),H(se.length,1),X},3),S($,"$_reduce_12",function(D,Q,R){return D["$[]"](1)},3),S($,"$_reduce_13",function(D,Q,R){return p(p(n("Arithmetic"),"Node"),"Negative").$new(D["$[]"](1))},3),S($,"$_reduce_14",function(D,Q,R){return p(p(n("Arithmetic"),"Node"),"BinaryOp").$new(D["$[]"](0),"+",D["$[]"](2))},3),S($,"$_reduce_15",function(D,Q,R){return p(p(n("Arithmetic"),"Node"),"BinaryOp").$new(D["$[]"](0),"-",D["$[]"](2))},3),S($,"$_reduce_16",function(D,Q,R){return U(this.allowed_cmp_op["$include?"](e))||this.$raise(n("ParseError")),s([],{})},3),S($,"$_reduce_17",function(D,Q,R){var w,X,W;return W=null==(w=I(D))[1]?e:w[1],U(this.allowed_cmp_op["$include?"](X=null==w[0]?e:w[0]))||this.$raise(n("ParseError")),s(["cmp_op","target"],{cmp_op:X,target:W})},3),S($,"$_reduce_18",function(D,Q,R){var ee,w=this;return ee=D["$[]"](0),U(w.question_target)||w.$raise(n("ParseError")),U(w.allowed_cmp_op["$include?"](ee))||w.$raise(n("ParseError")),s(["cmp_op","target"],{cmp_op:ee,target:"?"})},3),S($,"$_reduce_19",function(D,Q,R){return p(p(n("Arithmetic"),"Node"),"BinaryOp").$new(D["$[]"](0),"+",D["$[]"](2))},3),S($,"$_reduce_20",function(D,Q,R){return p(p(n("Arithmetic"),"Node"),"BinaryOp").$new(D["$[]"](0),"-",D["$[]"](2))},3),S($,"$_reduce_22",function(D,Q,R){return p(p(n("Arithmetic"),"Node"),"BinaryOp").$new(D["$[]"](0),"*",D["$[]"](2))},3),S($,"$_reduce_23",function(D,Q,R){return D["$[]"](3).$new(D["$[]"](0),D["$[]"](2))},3),S($,"$_reduce_25",function(D,Q,R){return p(p(n("Arithmetic"),"Node"),"DivideWithGameSystemDefault")},3),S($,"$_reduce_26",function(D,Q,R){return p(p(n("Arithmetic"),"Node"),"DivideWithCeil")},3),S($,"$_reduce_27",function(D,Q,R){return p(p(n("Arithmetic"),"Node"),"DivideWithCeil")},3),S($,"$_reduce_28",function(D,Q,R){return p(p(n("Arithmetic"),"Node"),"DivideWithRound")},3),S($,"$_reduce_29",function(D,Q,R){return p(p(n("Arithmetic"),"Node"),"DivideWithFloor")},3),S($,"$_reduce_30",function(D,Q,R){return D["$[]"](1)},3),S($,"$_reduce_31",function(D,Q,R){return p(p(n("Arithmetic"),"Node"),"Negative").$new(D["$[]"](1))},3),S($,"$_reduce_33",function(D,Q,R){return D["$[]"](1)},3),S($,"$_reduce_34",function(D,Q,R){return p(p(n("Arithmetic"),"Node"),"Number").$new(D["$[]"](0))},3),S($,"$_reduce_none",function(D,Q,R){return D["$[]"](0)},3)},Opal.modules["bcdice/deprecated/checker"]=function(r){var C,F,V,U,I,f,B,S,M=[],t=r.nil,m=r.module,e=r.send,p=r.eqeqeq,E=r.truthy,A=r.def;return C=M,F=S=[m(M[0],"BCDice")].concat(C),V=B=[m(S[0],"Deprecated")].concat(F),I=[U=m(B[0],"Checker")].concat(V),f=r.$r(I),U.$private(),A(U,"$check_result_legacy",function(q,L,N,b){var c,h=this,g=t,y=t,_=t,l=t;return g=e(L,"map",[],"sides".$to_proc()),c=(y=e(L,"map",[],"value".$to_proc())).$sum(),_=p([100],l=g)?h.$check_1D100(q,c,N,b):p([20],l)?h.$check_1D20(q,c,N,b):p([6,6],l)?h.$check_2D6(q,c,y,N,b):t,(E(_["$nil?"]())||E(_["$empty?"]()))&&(_=p([10],l=g.$uniq())?h.$check_nD10(q,c,y,N,b):p([6],l)?h.$check_nD6(q,c,y,N,b):t,E(_["$nil?"]())||E(_["$empty?"]()))?t:f("Result").$new(_.$delete_prefix(" \uff1e "))},4),A(U,"$check_1D100",function(q,L,N,b){return t},4),A(U,"$check_1D20",function(q,L,N,b){return t},4),A(U,"$check_nD10",function(q,L,N,b,h){return t},5),A(U,"$check_2D6",function(q,L,N,b,h){return t},5),A(U,"$check_nD6",function(q,L,N,b,h){return t},5)},Opal.modules["bcdice/base"]=function(r){var L,y,u,i,d,c,_,l,$,b,M=r.top,t=[],m=r.$r(t),e=r.nil,p=r.$$$,E=r.module,A=r.klass,s=r.truthy,C=r.def,Y=r.regexp,S=r.rb_plus,z=r.send,F=r.to_a,H=r.rb_minus,B=r.eqeqeq,j=r.eqeq,V=r.range,U=r.rb_divide,I=r.rb_times,f=r.rb_ge,a=e;return M.$require("i18n"),M.$require("i18n/backend/fallbacks"),M.$require("bcdice/randomizer"),M.$require("bcdice/dice_table"),M.$require("bcdice/enum"),M.$require("bcdice/translate"),M.$require("bcdice/result"),M.$require("bcdice/command/parser"),M.$require("bcdice/deprecated/checker"),L=t,y=b=[E(t[0],"BCDice")].concat(L),_=[c=A(b[0],null,"Base")].concat(y),l=r.$r(_),($=c.$$prototype).sort_add_dice=$.sort_barabara_dice=$.enabled_d9=$.raw_input=$.randomizer=$.enabled_upcase_input=$.debug=e,i=[u=r.get_singleton_class(c)].concat(_),d=r.$r(i),u.$attr_reader("prefixes"),C(u,"$register_prefix",function(v){var P,G=this,o=e;return null==G.prefixes&&(G.prefixes=e),P=r.slice.call(arguments),G.prefixes=s(o=G.prefixes)?o:[],G.prefixes.$concat(P.$flatten())},-1),C(u,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())},0),C(u,"$prefixes_pattern",function(){var v=this,T=e;return null==v.prefixes_pattern&&(v.prefixes_pattern=e),null==v.prefixes&&(v.prefixes=e),v.prefixes_pattern=s(T=v.prefixes_pattern)?T:e,s(v.prefixes_pattern)?v.prefixes_pattern:(v.prefixes=s(T=v.prefixes)?T:[],v.prefixes.$freeze(),v.prefixes_pattern=(s(v.prefixes["$empty?"]())?/(?!)/:Y(["^(S)?(",v.prefixes.$join("|"),")"],"i")).$freeze())},0),C(u,"$command_pattern",function(){var v=this,T=e,P=e;return null==v.command_pattern&&(v.command_pattern=e),null==v.prefixes&&(v.prefixes=e),v.command_pattern=s(T=v.command_pattern)?T:e,s(v.command_pattern)?v.command_pattern:(v.prefixes=s(T=v.prefixes)?T:[],v.prefixes.$freeze(),P=S(z(p(d("CommonCommand"),"COMMANDS"),"map",[],function(o){return null==o&&(o=e),p(o,"PREFIX_PATTERN").$source()},1),v.prefixes),v.command_pattern=Y(["^S?(",P.$join("|"),")"],"i").$freeze())},0),C(u,"$eval",function(v){return this.$new(v).$eval()},1),c.$include(l("Translate")),c.$include(p(l("Deprecated"),"Checker")),C(c,"$initialize",function(n){var i=this;return i.raw_input=n,i.sort_add_dice=!1,i.sort_barabara_dice=!1,i.d66_sort_type=p(l("D66SortType"),"NO_SORT"),i.enabled_d9=!1,i.round_type=p(l("RoundType"),"FLOOR"),i.sides_implicit_d=6,i.upper_dice_reroll_threshold=e,i.reroll_dice_reroll_threshold=e,i.default_cmp_op=e,i.default_target_number=e,i.enabled_upcase_input=!0,i.locale="ja_jp",i.randomizer=p(l("BCDice"),"Randomizer").$new(),i.debug=!1},1),c.$attr_accessor("randomizer"),c.$attr_reader("d66_sort_type"),c.$attr_reader("round_type"),c.$attr_reader("sides_implicit_d"),c.$attr_reader("upper_dice_reroll_threshold"),c.$attr_reader("reroll_dice_reroll_threshold"),c.$attr_reader("default_cmp_op"),c.$attr_reader("default_target_number"),C(c,"$sort_add_dice?",function(){return this.sort_add_dice},0),C(c,"$sort_barabara_dice?",function(){return this.sort_barabara_dice},0),C(c,"$enabled_d9?",function(){return this.enabled_d9},0),C(c,"$enable_debug",function(){return this.debug=!0},0),C(c,"$eval",function(){var i,d,x,n=this,v=e;return i=p(l("BCDice"),"Preprocessor").$process(n.raw_input,n),d=s(x=n.$dice_command(i))?x:n.$eval_common_command(n.raw_input),s(d)?(v=[n.randomizer.$rand_results()],z(d,"rands=",F(v)),H(v.length,1),v=[n.randomizer.$detailed_rand_results()],z(d,"detailed_rands=",F(v)),H(v.length,1),d):e},0),C(c,"$change_text",function(n){return n},1),C(c,"$check_result",function(n,i,d,x){var v=this,T=e,P=e,G=e,o=e,Z=e;return T=v.$check_result_legacy(n,i,d,x),s(T)?T:(P=z(i,"map",[],"sides".$to_proc()),o=(G=z(i,"map",[],"value".$to_proc())).$sum(),T=B([100],Z=P)?v.$result_1d100(n,o,d,x):B([20],Z)?v.$result_1d20(n,o,d,x):B([6,6],Z)?v.$result_2d6(n,o,G,d,x):e,j(T,l("Result").$nothing())?e:s(T)?T:(T=B([10],Z=P.$uniq())?v.$result_nd10(n,o,G,d,x):B([6],Z)?v.$result_nd6(n,o,G,d,x):e,j(T,l("Result").$nothing())?e:s(T)?T:v.$result_ndx(n,d,x)))},4),C(c,"$grich_text",function(n,i,d){return e},3),c.$private(),C(c,"$eval_common_command",function(n){try{return n=this.$change_text(n),z(p(l("CommonCommand"),"COMMANDS"),"each",[],function d(x){var T,v=null==d.$$s?this:d.$$s;if(null==v.randomizer&&(v.randomizer=e),null==x&&(x=e),T=x.$eval(n,v,v.randomizer),!s(T))return e;r.ret(T)},{$$arity:1,$$s:this}),e}catch(d){if(d===r.returner)return d.$v;throw d}},1),C(c,"$dice_command",function(n){var i=this,d=e,x=e,v=e,T=e,P=e;return s(i.enabled_upcase_input)&&(n=n.$upcase()),d=i.$class().$prefixes_pattern().$match(n),s(d)?(x=d["$[]"](1)["$nil?"]()["$!"](),s(x)&&(n=n["$[]"](V(1,-1,!1))),v=i.$eval_game_system_specific_command(n),s(v["$is_a?"](l("Result")))?(T=[s(P=v["$secret?"]())?P:x],z(v,"secret=",F(T)),H(T.length,1),v):s(v["$nil?"]())||s(v["$empty?"]())||j(v,"1")?e:z(l("Result").$new(),"tap",[],function(o){return null==o&&(o=e),T=[v.$to_s()],z(o,"text=",F(T)),H(T.length,1),z(o,"secret=",F(T=[x])),T[H(T.length,1)]},1)):e},1),C(c,"$eval_game_system_specific_command",function(n){return e},1),C(c,"$result_ndx",function(n,i,d){return s(d["$is_a?"](l("String")))?e:s(n.$send(i,d))?l("Result").$success(this.$translate("success")):l("Result").$failure(this.$translate("failure"))},3),C(c,"$result_1d100",function(n,i,d,x){return e},4),C(c,"$result_1d20",function(n,i,d,x){return e},4),C(c,"$result_nd10",function(n,i,d,x,v){return e},5),C(c,"$result_2d6",function(n,i,d,x,v){return e},5),C(c,"$result_nd6",function(n,i,d,x,v){return e},5),C(c,"$get_table_by_2d6",function(n){return this.$get_table_by_nD6(n,2)},1),C(c,"$get_table_by_1d6",function(n){return this.$get_table_by_nD6(n,1)},1),C(c,"$get_table_by_nD6",function(n,i){return this.$get_table_by_nDx(n,i,6)},2),C(c,"$get_table_by_nDx",function(n,i,d){var v,T=e;return v=this.randomizer.$roll_sum(i,d),T=this.$get_table_value(n["$[]"](H(v,i))),s(T["$nil?"]())?["1",0]:[T,v]},3),C(c,"$get_table_by_1d3",function(n){var x,v,i=this,T=e;return i.$debug("get_table_by_1d3"),x=i.randomizer.$roll_sum(1,6),i.$debug("num",x),v=U(H(x,1),2).$to_i(),i.$debug("index",v),T=n["$[]"](v),s(T["$nil?"]())?["1",0]:[T,x]},1),C(c,"$get_table_by_d66_swap",function(n){var d;return d=this.randomizer.$roll_d66(p(l("D66SortType"),"ASC")),[this.$get_table_by_number(d,n),d]},1),C(c,"$get_table_by_d66",function(n){var d,x,v,P,T=e;return d=this.randomizer.$roll_once(6),x=this.randomizer.$roll_once(6),v=S(I(H(d,1),6),H(x,1)),T=n["$[]"](v),P=""+d+x,s(T["$nil?"]())?["1",P]:[T,P]},1),C(c,"$get_table_by_number",function(n,i,d){try{return null==d&&(d="1"),z(i,"each",[],function v(T){var G,P=null==v.$$s?this:v.$$s;if(null==T&&(T=e),G=T["$[]"](0),!s(f(G,n)))return e;r.ret(P.$get_table_value(T["$[]"](1)))},{$$arity:1,$$s:this}),this.$get_table_value(d)}catch(v){if(v===r.returner)return v.$v;throw v}},-3),C(c,"$get_table_value",function(n){return s(n["$is_a?"](l("Proc")))?n.$call():n},1),C(c,"$roll_tables",function(n,i){var x=e;return x=i["$[]"](n),s(x)?x.$roll(this.randomizer).$to_s():e},2),C(c,"$debug",function(n,i){var x,v=this,T=e,P=e;return x=r.slice.call(arguments,1),s(v.debug)?(T=s(n["$is_a?"](l("String")))?n:n.$inspect(),s(x["$empty?"]())?v.$warn(T):(P=z(x,"map",[],function(o){return null==o&&(o=e),s(o["$is_a?"](l("String")))?'"'+o+'"':o.$inspect()},1),v.$warn(T+": "+P.$join(", ")))):e},-2),p(p(m("I18n"),"Backend"),"Simple").$include(p(p(m("I18n"),"Backend"),"Fallbacks")),m("I18n").$load_path()["$<<"](m("Dir")["$[]"](m("File").$join("bcdice","../../i18n/**/*.yml"))),a=["ja_jp"],z(m("I18n"),"default_locale=",F(a)),H(a.length,1),a=[["ja_jp"]],z(m("I18n").$fallbacks(),"defaults=",F(a)),a[H(a.length,1)]},Opal.queue(function(r){var I,L,c,_,l,$,b,h,a,t=[],m=r.nil,e=r.module,p=r.klass,E=r.const_set,A=r.truthy,s=r.def,C=r.to_ary,Y=r.rb_plus,S=r.rb_minus,z=r.rb_gt,F=r.send,H=r.to_a,B=r.eqeq,j=r.rb_lt,V=r.rb_ge;return r.top.$require("bcdice/base"),I=t,L=a=[e(t[0],"BCDice")].concat(I),b=[e(a[0],"GameSystem")].concat(L),h=r.$r(b),c=b,l=[_=p(b[0],h("Base"),"ZettaiReido")].concat(c),$=r.$r(l),_.$$prototype.randomizer=m,E(l[0],"ID","ZettaiReido"),E(l[0],"NAME","\u7d76\u5bfe\u96b7\u5974"),E(l[0],"SORT_KEY","\u305b\u3064\u305f\u3044\u308c\u3044\u3068"),E(l[0],"HELP_MESSAGE","\u30fb\u5224\u5b9a\nm-2DR+n>=x\nm(\u57fa\u672c\u80fd\u529b),n(\u4fee\u6b63\u5024),x(\u76ee\u6a19\u5024)\nDP\u306e\u53d6\u5f97\u306e\u6709\u7121\u3082\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n"),_.$register_prefix("\\d+\\-2DR"),s(_,"$eval_game_system_specific_command",function(i){var x=m,v=m,T=m;return A(i["$=~"](/^(\d+)-2DR([+\-\d]*)(>=(\d+))?$/i))?(x=$("Regexp").$last_match(1).$to_i(),v=$("Regexp").$last_match(2),T=$("Regexp").$last_match(4),this.$roll2DR(x,v,T)):m},1),s(_,"$roll2DR",function(i,d,x){var v,T,G,o,Z,k,O,Q,P=this,ne=m,ce=m,te=m,K=m,D=m;return T=P.$roll2DarkDice(),G=null==(v=C(T))[0]?m:v[0],o=null==v[1]?m:v[1],Z=null==v[2]?m:v[2],T=P.$getModInfo(d),k=null==(v=C(T))[0]?m:v[0],d=null==v[1]?m:v[1],T=P.$getDiffInfo(x),O=null==(v=C(T))[0]?m:v[0],ne="("+i+"-2DR"+d+(null==v[1]?m:v[1])+")",ce=i+"-"+G+"["+o+"]"+d,te=Y(S(i,G),k),K=P.$getResult(G,te,O),A(z(Z,0))&&(D=Z+"DP"),Q=[[ne,ce,te.$to_i(),K.$text(),D].$compact().$join(" \uff1e ")],F(K,"text=",H(Q)),S(Q.length,1),K},3),s(_,"$roll2DarkDice",function(){var i,d,v,T,P,G,o,x=this,k=m;return v=x.randomizer.$roll_once(6),T=x.randomizer.$roll_once(6),d=x.$changeDiceToDarkDice(v),P=null==(i=C(d))[0]?m:i[0],G=null==i[1]?m:i[1],d=x.$changeDiceToDarkDice(T),o=null==(i=C(d))[0]?m:i[0],k=Y(G,null==i[1]?m:i[1]),B(k,2)&&(k=4),[Y(P,o),P+","+o,k]},0),s(_,"$changeDiceToDarkDice",function(i){var d=m,x=m;return d=0,x=i,B(i,6)&&(x=0,d=1),[x,d]},1),s(_,"$getModInfo",function(i){var d=m,x=m;return d=$("ArithmeticEvaluator").$eval(i),x="",A(j(d,0))?x=d.$to_s():A(z(d,0))&&(x=Y("+",d.$to_s())),[d,x]},1),s(_,"$getDiffInfo",function(i){var d=m;return d="",A(i["$nil?"]())||(d=">="+(i=i.$to_i()).$to_i()),[i,d]},1),s(_,"$getResult",function(i,d,x){var v=m;return B(i,0)?$("Result").$critical("\u30af\u30ea\u30c6\u30a3\u30ab\u30eb"):B(i,10)?$("Result").$fumble("\u30d5\u30a1\u30f3\u30d6\u30eb"):(A(x["$nil?"]())&&(x=0),v=S(d,x),A(V(v,0))?$("Result").$success(v+" \u6210\u529f"):$("Result").$failure("\u5931\u6557"))},3)})}}]);