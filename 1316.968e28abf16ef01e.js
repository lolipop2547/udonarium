(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[1316],{1316:(ae,ie,se)=>{se(9993),Opal.modules["bcdice/arithmetic_evaluator"]=function(n){var O,Y,M,J,Q,P,X,b,G=[],o=n.nil,r=n.$$$,z=n.module,B=n.hash2,A=n.truthy,R=n.def;return O=G,Y=b=[z(G[0],"BCDice")].concat(O),X=[P=z(b[0],"ArithmeticEvaluator")].concat(Y),J=[M=n.get_singleton_class(P)].concat(X),Q=n.$r(J),R(M,"$eval",function(H,a){var N,W=o;if(null==a)a=B([],{});else if(!a.$$is_hash)throw n.ArgumentError.$new("expected kwargs");return null==(N=a.$$smap.round_type)&&(N=r(Q("RoundType"),"FLOOR")),A(H)&&A(W=Q("Arithmetic").$eval(H,N))?W:0},-2)},Opal.modules["bcdice/dice_table/range_table"]=function(n){var X,Q,W,x,V,C,U,H,k,G=[],o=n.nil,r=n.module,z=n.klass,B=n.const_set,A=n.send,R=n.truthy,q=n.def,O=n.to_a,h=n.rb_minus,b=n.eqeqeq,F=n.rb_times,Y=n.rb_plus;return X=G,Q=k=[r(G[0],"BCDice")].concat(X),W=H=[r(k[0],"DiceTable")].concat(Q),V=[x=z(H[0],null,"RangeTable")].concat(W),C=n.$r(V),(U=x.$$prototype).name=U.items=U.num_of_dice=U.num_of_sides=U.formatter=o,B(V[0],"RollResult",A(C("Struct"),"new",["sum","values","content","formatted"],function L(){return(null==L.$$s?this:L.$$s).$alias_method("to_s","formatted")},{$$arity:0,$$s:x})),B(V[0],"Item",C("Struct").$new("range","content")),B(V[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),B(V[0],"DEFAULT_FORMATTER",A(x,"lambda",[],function(u,i){return null==u&&(u=o),null==i&&(i=o),u.$name()+"("+i.$sum()+") \uff1e "+i.$content()},2)),x.$attr_reader("name"),x.$attr_reader("num_of_dice"),x.$attr_reader("num_of_sides"),q(x,"$initialize",function L(u,i,f){var l,d=L.$$p||o,v=this,_=o;return delete L.$$p,v.name=u.$freeze(),v.formatter=R(l=d)?l:C("DEFAULT_FORMATTER"),_=C("DICE_ROLL_METHOD_RE").$match(i),R(_)||v.$raise(C("ArgumentError"),v.name+": invalid dice roll method: "+i),v.num_of_dice=_["$[]"](1).$to_i(),v.num_of_sides=_["$[]"](2).$to_i(),v.$store(f)},3),q(x,"$fetch",function(u){var f,i=this;return f=A(i.items,"find",[],function(v){return null==v&&(v=o),v.$range()["$include?"](u)},1),R(f)||i.$raise(C("RangeError"),i.name+": value is out of range: "+u),f},1),q(x,"$roll",function(u){var d,v,l,i=this,f=o;return d=(f=u.$roll_barabara(i.num_of_dice,i.num_of_sides)).$sum(),v=C("RollResult").$new(d,f,i.$fetch(d).$content()),l=[i.formatter["$[]"](i,v)],A(v,"formatted=",O(l)),h(l.length,1),v},1),x.$private(),q(x,"$store",function(u){var f,d,i=this;return f=A(u,"map",[],function v(l,_){return null==l&&(l=o),null==_&&(_=o),[(null==v.$$s?this:v.$$s).$coerce_to_int_range(l),_]},{$$arity:2,$$s:i}),d=A(f,"sort_by",[],function(l,_){return null==l&&(l=o),null==_&&(_=o),l.$min()},2),i.$assert_min_sum_is_covered(d),i.$assert_max_sum_is_covered(d),i.$assert_no_gap_or_overlap_in_ranges(d),i.items=A(d,"map",[],function(l,_){return null==l&&(l=o),null==_&&(_=o),C("Item").$new(l,_.$freeze()).$freeze()},2).$freeze(),i},1),q(x,"$coerce_to_int_range",function(u){var f;return b(C("Integer"),f=u)?C("Range").$new(u,u):b(C("Range"),f)&&R(u.$begin()["$is_a?"](C("Integer")))&&R(u.$end()["$is_a?"](C("Integer")))?u:this.$raise(C("TypeError"),this.name+": "+u+" ("+u.$class()+") must be an Integer or a Range with Integers ")},1),q(x,"$assert_min_sum_is_covered",function(u){var f,i=this,d=o;return f=i.num_of_dice,d=u.$first()["$[]"](0),R(d["$include?"](f))||i.$raise(C("RangeError"),i.name+": min value ("+f+") is not covered: "+d),i},1),q(x,"$assert_max_sum_is_covered",function(u){var f,i=this,d=o;return f=F(i.num_of_dice,i.num_of_sides),d=u.$last()["$[]"](0),R(d["$include?"](f))||i.$raise(C("RangeError"),i.name+": max value ("+f+") is not covered: "+d),i},1),q(x,"$assert_no_gap_or_overlap_in_ranges",function(u){return A(u,"each_cons",[2],function f(d,v){var ee,y,l=null==f.$$s?this:f.$$s,_=o,j=o;return null==l.name&&(l.name=o),null==d&&(d=o),null==v&&(v=o),_=d["$[]"](0),j=v["$[]"](0),ee=_.$max(),y=Y(ee,1),R(j["$include?"](ee))&&l.$raise(C("RangeError"),l.name+": Range overlap: "+_+" and "+j),R(j["$include?"](y))?o:l.$raise(C("RangeError"),l.name+": Range gap: "+_+" and "+j)},{$$arity:2,$$s:this}),this},1)},Opal.queue(function(n){var W,U,f,d,v,$,e,I,t,m,l,_,j,u,i,V,G=n.top,o=[],r=n.nil,z=n.$$$,B=n.module,A=n.klass,R=n.const_set,q=n.send2,O=n.find_super,h=n.def,b=n.truthy,F=n.rb_lt,Y=n.rb_gt,P=n.rb_plus,X=n.send,M=n.to_a,k=n.rb_minus,J=n.rb_ge,Q=n.eqeq,s=n.hash2,H=n.to_ary,a=n.range;return G.$require("bcdice/arithmetic_evaluator"),G.$require("bcdice/dice_table/range_table"),W=o,U=V=[B(o[0],"BCDice")].concat(W),u=[B(V[0],"GameSystem")].concat(U),i=n.$r(u),f=u[0],d=i("Base"),v=u,_=[l=A(f,d,"DoubleCross")].concat(v),j=n.$r(_),l.$$prototype.randomizer=r,R(_[0],"ID","DoubleCross"),R(_[0],"NAME","\u30c0\u30d6\u30eb\u30af\u30ed\u30b92nd,3rd"),R(_[0],"SORT_KEY","\u305f\u3075\u308b\u304f\u308d\u30592"),R(_[0],"HELP_MESSAGE",'\u30fb\u5224\u5b9a\u30b3\u30de\u30f3\u30c9\uff08xDX+y@c or xDXc+y\uff09\n\u3000"(\u500b\u6570)DX(\u4fee\u6b63)@(\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024)" \u3082\u3057\u304f\u306f "(\u500b\u6570)DX(\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024)(\u4fee\u6b63)" \u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u4fee\u6b63\u5024\u3082\u4ed8\u3051\u3089\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff0910dx\u3000\u300010dx+5@8\uff08OD tool\u5f0f)\u3000\u30005DX7+7-3\uff08\u75be\u98a8\u6012\u6fe4\u5f0f\uff09\n\n\u30fb\u5404\u7a2e\u8868\n\u3000\u30fb\u611f\u60c5\u8868\uff08ET\uff09\n\u3000\u3000\u30dd\u30b8\u30c6\u30a3\u30d6\u3068\u30cd\u30ac\u30c6\u30a3\u30d6\u306e\u4e21\u65b9\u3092\u632f\u3063\u3066\u3001\u8868\u306b\u306a\u3063\u3066\u3044\u308b\u5074\u306b\u25cb\u3092\u4ed8\u3051\u3066\u8868\u793a\u3057\u307e\u3059\u3002\n\u3000\u3000\u3082\u3061\u308d\u3093\u4efb\u610f\u3067\u9078\u3076\u90e8\u5206\u306f\u5909\u66f4\u3057\u3066\u69cb\u3044\u307e\u305b\u3093\u3002\n\n\u30fbD66\u30c0\u30a4\u30b9\u3042\u308a\n'),h(l,"$initialize",function y(g){var e=this;return delete y.$$p,q(e,O(e,"initialize",y,!1,!0),"initialize",[g],null),e.sides_implicit_d=10},1),l.$register_prefix("\\d+DX","ET"),$=_,I=[e=A(_[0],null,"DX")].concat($),t=n.$r(I),(m=e.$$prototype).modifier=m.critical_value=m.expression=m.num=m.modifier_str=m.target_value=r,e.$include(t("Translate")),h(e,"$initialize",function(E,w,D,c){var T=this;return T.num=E,T.critical_value=w,T.modifier=D,T.target_value=c,T.modifier_str=t("Format").$modifier(T.modifier),T.expression=T.$node_expression(),T.locale="ja_jp"},4),h(e,"$execute",function(E){var D=this,c=r,T=r,S=r,te=r,Z=r,K=r;if(b(F(D.critical_value,2)))return t("Result").$new("("+D.expression+") \uff1e "+D.$translate("DoubleCross.DX.invalid_critical"));if(b(F(D.num,1)))return t("Result").$failure("("+D.expression+") \uff1e "+D.$translate("DoubleCross.DX.auto_failure"));for(c=[],T=D.num,S=0;b(b(te=Y(T,0))?F(S,z(z(t("CommonCommand"),"RerollDice"),"REROLL_LIMIT")):te);)Z=E.$roll_barabara(T,10),K=t("ValueGroup").$new(Z,D.critical_value),c.$push(K),T=K.$num_of_critical_occurrences(),S=P(S,1);return D.$result(c)},1),e.$private(),h(e,"$node_expression",function(){var w,E=this;return w=E.num+"DX"+E.critical_value+E.modifier_str,b(E.target_value)?w+">="+E.target_value:w},0),h(e,"$result",function(E){var T,te,w=this,D=r,c=r,S=r,Z=r,K=r,re=r,ne=r;return D=t("Result").$new(),c=[E["$[]"](0).$values()["$all?"](1)],X(D,"fumble=",M(c)),k(c.length,1),T=X(E,"map",[],"max".$to_proc()).$sum(),S=b(D["$fumble?"]())?0:P(T,w.modifier),te=b(D["$fumble?"]())?S+" ("+w.$translate("fumble")+")":S.$to_s(),c=[Y(E.$length(),1)],X(D,"critical=",M(c)),k(c.length,1),Z=["("+w.expression+")",""+E.$join("+")+w.modifier_str,te],b(w.target_value)&&(K=b(re=D["$fumble?"]()["$!"]())?J(S,w.target_value):re,b(K)?(X(D,"success=",M(c=[!0])),k(c.length,1)):(X(D,"failure=",M(c=[!0])),k(c.length,1)),ne=w.$translate(b(K)?"success":"failure"),Z.$push(ne)),c=[Z.$join(" \uff1e ")],X(D,"text=",M(c)),k(c.length,1),D},1),function(y,g){var $=A(y,null,"ValueGroup"),e=$.$$prototype;e.values=e.critical_value=r,$.$attr_reader("values"),$.$attr_reader("critical_value"),h($,"$initialize",function(t,m){return this.values=t.$sort(),this.critical_value=m},2),h($,"$to_s",function(){return this.$max()+"["+this.values.$join(",")+"]"},0),h($,"$max",function(){var t=this;return b(X(t.values,"any?",[],function m(p){return null==p&&(p=r),(null==m.$$s?this:m.$$s)["$critical?"](p)},{$$arity:1,$$s:t}))?10:t.values.$max()},0),h($,"$num_of_critical_occurrences",function(){return X(this.values,"count",[],function m(p){return null==p&&(p=r),(null==m.$$s?this:m.$$s)["$critical?"](p)},{$$arity:1,$$s:this})},0),$.$private(),h($,"$critical?",function(t){return J(t,this.critical_value)},1)}(_[0]),h(l,"$eval_game_system_specific_command",function(g){var $=this,e=r;return b(e=$.$parse_dx(g))?e.$execute($.randomizer):Q(g,"ET")?$.$roll_emotion_table():r},1),l.$private(),h(l,"$parse_dx",function(g){var e;return b(e=this.$parse_dx_od(g))?e:this.$parse_dx_shippu_doto(g)},1),h(l,"$parse_dx_od",function(g){var I=r,t=r,m=r,p=r;return I=z(j("Command"),"Parser").$new(/\d+DX/,s(["round_type"],{round_type:this.$round_type()})).$enable_critical().$restrict_cmp_op_to(r,">=").$parse(g),b(I)?(t=I.$command().$to_i(),m=b(p=I.$critical())?p:10,z(this.$class(),"DX").$new(t,m,I.$modify_number(),I.$target_number())):r},1),h(l,"$parse_dx_shippu_doto",function(g){var $,e,m=r,p=r,E=r,w=r;return m=z(j("Command"),"Parser").$new(/\d+DX\d*/,s(["round_type"],{round_type:this.$round_type()})).$restrict_cmp_op_to(r,">=").$parse(g),b(m)?(e=X(m.$command().$split("DX",2),"map",[],function(c){var T;return null==c&&(c=r),(T=c)===r||null==T?r:X(T,"to_i",[])},1),p=null==($=H(e))[0]?r:$[0],E=b(w=E=null==$[1]?r:$[1])?w:10,z(this.$class(),"DX").$new(p,E,m.$modify_number(),m.$target_number())):r},1),h(l,"$roll_emotion_table",function(){var I,g=this,$=r,e=r,t=r,p=r;return $=z(g.$class(),"POSITIVE_EMOTION_TABLE").$roll(g.randomizer),e=z(g.$class(),"NEGATIVE_EMOTION_TABLE").$roll(g.randomizer),I=g.randomizer.$roll_once(2)["$=="](1),t=b(I)?["\u25cb"+$.$content(),e.$content()]:[$.$content(),"\u25cb"+e.$content()],p=[g.$translate("DoubleCross.ET.name")+"("+$.$sum()+"-"+e.$sum()+")",t.$join(" - ")],j("Result").$new(p.$join(" \uff1e "))},0),function(y,g){var $=[y].concat(g),e=n.$r($);y.$private(),h(y,"$positive_emotion_table",function(t){return z(e("DiceTable"),"RangeTable").$new(e("I18n").$translate("DoubleCross.ET.positive.name",s(["locale"],{locale:t})),"1D100",[[a(1,5,!1),e("I18n").$translate("DoubleCross.ET.positive.items.1_5",s(["locale"],{locale:t}))],[a(6,10,!1),e("I18n").$translate("DoubleCross.ET.positive.items.6_10",s(["locale"],{locale:t}))],[a(11,15,!1),e("I18n").$translate("DoubleCross.ET.positive.items.11_15",s(["locale"],{locale:t}))],[a(16,20,!1),e("I18n").$translate("DoubleCross.ET.positive.items.16_20",s(["locale"],{locale:t}))],[a(21,25,!1),e("I18n").$translate("DoubleCross.ET.positive.items.21_25",s(["locale"],{locale:t}))],[a(26,30,!1),e("I18n").$translate("DoubleCross.ET.positive.items.26_30",s(["locale"],{locale:t}))],[a(31,35,!1),e("I18n").$translate("DoubleCross.ET.positive.items.31_35",s(["locale"],{locale:t}))],[a(36,40,!1),e("I18n").$translate("DoubleCross.ET.positive.items.36_40",s(["locale"],{locale:t}))],[a(41,45,!1),e("I18n").$translate("DoubleCross.ET.positive.items.41_45",s(["locale"],{locale:t}))],[a(46,50,!1),e("I18n").$translate("DoubleCross.ET.positive.items.46_50",s(["locale"],{locale:t}))],[a(51,55,!1),e("I18n").$translate("DoubleCross.ET.positive.items.51_55",s(["locale"],{locale:t}))],[a(56,60,!1),e("I18n").$translate("DoubleCross.ET.positive.items.56_60",s(["locale"],{locale:t}))],[a(61,65,!1),e("I18n").$translate("DoubleCross.ET.positive.items.61_65",s(["locale"],{locale:t}))],[a(66,70,!1),e("I18n").$translate("DoubleCross.ET.positive.items.66_70",s(["locale"],{locale:t}))],[a(71,75,!1),e("I18n").$translate("DoubleCross.ET.positive.items.71_75",s(["locale"],{locale:t}))],[a(76,80,!1),e("I18n").$translate("DoubleCross.ET.positive.items.76_80",s(["locale"],{locale:t}))],[a(81,85,!1),e("I18n").$translate("DoubleCross.ET.positive.items.81_85",s(["locale"],{locale:t}))],[a(86,90,!1),e("I18n").$translate("DoubleCross.ET.positive.items.86_90",s(["locale"],{locale:t}))],[a(91,95,!1),e("I18n").$translate("DoubleCross.ET.positive.items.91_95",s(["locale"],{locale:t}))],[a(96,100,!1),e("I18n").$translate("DoubleCross.ET.positive.items.96_100",s(["locale"],{locale:t}))]])},1),h(y,"$negative_emotion_table",function(t){return z(e("DiceTable"),"RangeTable").$new(e("I18n").$translate("DoubleCross.ET.negative.name",s(["locale"],{locale:t})),"1D100",[[a(1,5,!1),e("I18n").$translate("DoubleCross.ET.negative.items.1_5",s(["locale"],{locale:t}))],[a(6,10,!1),e("I18n").$translate("DoubleCross.ET.negative.items.6_10",s(["locale"],{locale:t}))],[a(11,15,!1),e("I18n").$translate("DoubleCross.ET.negative.items.11_15",s(["locale"],{locale:t}))],[a(16,20,!1),e("I18n").$translate("DoubleCross.ET.negative.items.16_20",s(["locale"],{locale:t}))],[a(21,25,!1),e("I18n").$translate("DoubleCross.ET.negative.items.21_25",s(["locale"],{locale:t}))],[a(26,30,!1),e("I18n").$translate("DoubleCross.ET.negative.items.26_30",s(["locale"],{locale:t}))],[a(31,35,!1),e("I18n").$translate("DoubleCross.ET.negative.items.31_35",s(["locale"],{locale:t}))],[a(36,40,!1),e("I18n").$translate("DoubleCross.ET.negative.items.36_40",s(["locale"],{locale:t}))],[a(41,45,!1),e("I18n").$translate("DoubleCross.ET.negative.items.41_45",s(["locale"],{locale:t}))],[a(46,50,!1),e("I18n").$translate("DoubleCross.ET.negative.items.46_50",s(["locale"],{locale:t}))],[a(51,55,!1),e("I18n").$translate("DoubleCross.ET.negative.items.51_55",s(["locale"],{locale:t}))],[a(56,60,!1),e("I18n").$translate("DoubleCross.ET.negative.items.56_60",s(["locale"],{locale:t}))],[a(61,65,!1),e("I18n").$translate("DoubleCross.ET.negative.items.61_65",s(["locale"],{locale:t}))],[a(66,70,!1),e("I18n").$translate("DoubleCross.ET.negative.items.66_70",s(["locale"],{locale:t}))],[a(71,75,!1),e("I18n").$translate("DoubleCross.ET.negative.items.71_75",s(["locale"],{locale:t}))],[a(76,80,!1),e("I18n").$translate("DoubleCross.ET.negative.items.76_80",s(["locale"],{locale:t}))],[a(81,85,!1),e("I18n").$translate("DoubleCross.ET.negative.items.81_85",s(["locale"],{locale:t}))],[a(86,90,!1),e("I18n").$translate("DoubleCross.ET.negative.items.86_90",s(["locale"],{locale:t}))],[a(91,95,!1),e("I18n").$translate("DoubleCross.ET.negative.items.91_95",s(["locale"],{locale:t}))],[a(96,100,!1),e("I18n").$translate("DoubleCross.ET.negative.items.96_100",s(["locale"],{locale:t}))]]).$freeze()},1)}(n.get_singleton_class(l),_),R(_[0],"POSITIVE_EMOTION_TABLE",l.$positive_emotion_table("ja_jp").$freeze()),R(_[0],"NEGATIVE_EMOTION_TABLE",l.$negative_emotion_table("ja_jp").$freeze())})}}]);